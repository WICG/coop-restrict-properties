<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <title>Cross-Origin-Opener-Policy: restrict-properties</title>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <link href="https://www.w3.org/StyleSheets/TR/2021/cg-draft" rel="stylesheet">
  <meta content="Bikeshed version 82ce88815, updated Thu Sep 7 16:33:55 2023 -0700" name="generator">
  <link href="https://github.com/WICG/coop-restrict-properties" rel="canonical">
  <meta content="0aa8bc40d39a9e0eb39db6ef4e5c60aeb8fb169d" name="document-revision">
<style>
.monkey-patch {
    padding: .5em;
    border: thin solid #ddd;
    border: thin solid 1px;
    border-radius: .5em;
    margin: .5em calc(-0.5em - 1px);
    background-color: rgba(255, 255, 0, 0.03);
    backdrop-filter: blur(5px);
    box-shadow: 0px 5px 5px 0px rgba(0, 0, 0, 0.05);
}

.brief {
  line-height: 10%;
}

.customHighlight {
  padding-top:9px ;
  padding-bottom:9px ;
  background-color: rgba(255,255,0,0.3)
}

</style>
<style>/* Boilerplate: style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
<style>/* Boilerplate: style-colors */

/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
</style>
<style>/* Boilerplate: style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    white-space: pre;
    display: inline-block;
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: .5em;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
}

.dfn-paneled[role="button"] { cursor: pointer; }
</style>
<style>/* Boilerplate: style-dfn-panel */
:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
}
@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
    }
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    width: 20em;
    width: 300px;
    height: auto;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
    white-space: normal; /* in case it's moved into a pre */
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0 0 0 1em; list-style: none; }
.dfn-panel li a {
    white-space: pre;
    display: inline-block;
    max-width: calc(300px - 1.5em - 1em);
    overflow: hidden;
    text-overflow: ellipsis;
}

.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: .5em;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
}

.dfn-paneled[role="button"] { cursor: pointer; }
</style>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-selflinks */

:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* Boilerplate: style-wpt */
:root {
    --wpt-border: hsl(0, 0%, 60%);
    --wpt-bg: hsl(0, 0%, 95%);
    --wpt-text: var(--text);
    --wptheading-text: hsl(0, 0%, 30%);
}
@media (prefers-color-scheme: dark) {
    :root {
        --wpt-border: hsl(0, 0%, 30%);
        --wpt-bg: var(--borderedblock-bg);
        --wpt-text: var(--text);
        --wptheading-text: hsl(0, 0%, 60%);
    }
}
.wpt-tests-block {
    list-style: none;
    border-left: .5em solid var(--wpt-border);
    background: var(--wpt-bg);
    color: var(--wpt-text);
    margin: 1em auto;
    padding: .5em;
}
.wpt-tests-block summary {
    color: var(--wptheading-text);
    font-weight: normal;
    text-transform: uppercase;
}
.wpt-tests-block summary::marker{
    color: var(--wpt-border);
}
.wpt-tests-block summary:hover::marker{
    color: var(--wpt-text);
}
/*
   The only content  of a wpt test block in its closed state is the <summary>,
   which contains the word TESTS,
   and that is absolutely positioned.
   In that closed state, wpt test blocks are styled
   to have a top margin whose height is exactly equal
   to the height of the absolutely positioned <summary>,
   and no other background/padding/margin/border.
   The wpt test block elements will therefore allow the maring
   of the previous/next block elements
   to collapse through them;
   if this combined margin would be larger than its own top margin,
   it stays as is,
   and therefore the pre-existing vertical rhythm of the document is undisturbed.
   If that combined margin would be smaller, it is grown to that size.
   This means that the wpt test block ensures
   that there's always enough vertical space to insert the summary,
   without adding more than is needed.
*/
.wpt-tests-block:not([open]){
    padding: 0;
    border: none;
    background: none;
    font-size: 0.75em;
    line-height: 1;
    position: relative;
    margin: 1em 0 0;
}
.wpt-tests-block:not([open]) summary {
    position: absolute;
    right: 0;
    bottom: 0;
}
/*
   It is possible that both the last child of a block element
   and the block element itself
   would be annotated with a <wpt> block each.
   If the block element has a padding or a border,
   that's fine, but otherwise
   the bottom margin of the block and of its last child would collapse
   and both <wpt> elements would overlap, being both placed there.
   To avoid that, add 1px of padding to the <wpt> element annotating the last child
   to prevent the bottom margin of the block and of its last child from collapsing
   (and as much negative margin,
   as wel only want to prevent margin collapsing,
   but are not trying to actually take more space).
*/
.wpt-tests-block:not([open]):last-child {
    padding-bottom: 1px;
    margin-bottom: -1px;
}
/*
   Exception to the previous rule:
   don't do that in non-last list items,
   because it's not necessary,
   and would therefore consume more space than strictly needed.
   Lists must have list items as children, not <wpt> elements,
   so a <wpt> element cannot be a sibling of a list item,
   and the collision that the previous rule avoids cannot happen.
*/
li:not(:last-child) > .wpt-tests-block:not([open]):last-child,
dd:not(:last-child) > .wpt-tests-block:not([open]):last-child {
    padding-bottom: 0;
    margin-bottom: 0;
}
.wpt-tests-block:not([open]):not(:hover){
    opacity: 0.5;
}
.wpt-tests-list {
    list-style: none;
    display: grid;
    margin: 0;
    padding: 0;
    grid-template-columns: 1fr max-content auto auto;
    grid-column-gap: .5em;
}
.wpt-tests-block hr:last-child {
    display: none;
}
.wpt-test {
    display: contents;
}
.wpt-test > a {
    text-decoration: underline;
    border: none;
}
.wpt-test > .wpt-name { grid-column: 1; }
.wpt-test > .wpt-results { grid-column: 2; }
.wpt-test > .wpt-live { grid-column: 3; }
.wpt-test > .wpt-source { grid-column: 4; }

.wpt-test > .wpt-results {
    display: flex;
    gap: .1em;
}
.wpt-test .wpt-result {
    display: inline-block;
    height: 1em;
    width: 1em;
    border-radius: 50%;
    position: relative;
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">Cross-Origin-Opener-Policy: restrict-properties</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types#CG-DRAFT">Draft Community Group Report</a>, <time class="dt-updated" datetime="2023-11-16">16 November 2023</time></p>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://github.com/WICG/coop-restrict-properties">https://github.com/WICG/coop-restrict-properties</a>
     <dt>Issue Tracking:
     <dd><a href="https://github.com/WICG/coop-restrict-properties/issues/">GitHub</a>
     <dt class="editor">Editor:
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:clamy@google.com">Camille Lamy</a> (<span class="p-org org">Google</span>)
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright">©2023, Google, Inc. All rights reserved.</p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This proposal explores a new Cross-Origin-Opener-Policy value, "restrict-properties",

  that would enable crossOriginIsolated while preserving cross-origin popup
  access to a subset of WindowProxy methods.</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> This specification was published by the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a>.
  It is not a W3C Standard nor is it on the W3C Standards Track.

  Please note that under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a> there is a limited opt-out and other conditions apply.

  Learn more about <a href="http://www.w3.org/community/">W3C Community and Business Groups</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li>
     <a href="#introduction"><span class="secno">1</span> <span class="content">Introduction</span></a>
     <ol class="toc">
      <li><a href="#recommended-readings"><span class="secno">1.1</span> <span class="content">Recommended readings</span></a>
     </ol>
    <li><a href="#problem"><span class="secno">2</span> <span class="content">A problem</span></a>
    <li>
     <a href="#explainer"><span class="secno">3</span> <span class="content">Explainer</span></a>
     <ol class="toc">
      <li><a href="#coop-restrict-properties-proposal"><span class="secno">3.1</span> <span class="content">The COOP: restrict-properties proposal</span></a>
      <li><a href="#coop-rp-current-algo"><span class="secno">3.2</span> <span class="content">Fitting COOP: restrict-properties into current algorithm</span></a>
      <li><a href="#extra-requirements"><span class="secno">3.3</span> <span class="content">Extra requirements for common use cases</span></a>
     </ol>
    <li>
     <a href="#alternatives"><span class="secno">4</span> <span class="content">Alternatives considered</span></a>
     <ol class="toc">
      <li><a href="#extra-keying"><span class="secno">4.1</span> <span class="content">Extra-keying on Agent Clusters</span></a>
      <li><a href="#same-origin-allow-popups-plus-coep"><span class="secno">4.2</span> <span class="content">COOP same-origin-allow-popups-plus-coep</span></a>
     </ol>
    <li><a href="#tests"><span class="secno">5</span> <span class="content">Tests</span></a>
    <li>
     <a href="#specification"><span class="secno">6</span> <span class="content">Specification</span></a>
     <ol class="toc">
      <li>
       <a href="#cross-origin-opener-policies"><span class="secno">6.1</span> <span class="content">Cross-origin-opener-policies</span></a>
       <ol class="toc">
        <li><a href="#coop-values"><span class="secno">6.1.1</span> <span class="content">Cross-origin opener policy values</span></a>
        <li><a href="#obtain-coop"><span class="secno">6.1.2</span> <span class="content">Obtaining a cross-origin opener policy</span></a>
        <li><a href="#coop-bcg-switch"><span class="secno">6.1.3</span> <span class="content">Browsing context group switches due to cross-origin opener policy</span></a>
        <li><a href="#coop-reporting"><span class="secno">6.1.4</span> <span class="content">Reporting</span></a>
       </ol>
      <li>
       <a href="#coop-navigation-apis"><span class="secno">6.2</span> <span class="content">APIs related to navigation and session history</span></a>
       <ol class="toc">
        <li><a href="#coop-security-infracstructure"><span class="secno">6.2.1</span> <span class="content">Security infrastructure for Window, WindowProxy, and Location objects</span></a>
        <li><a href="#coop-window-proxy"><span class="secno">6.2.2</span> <span class="content">The WindowProxy exotic object</span></a>
        <li><a href="#coop-location-interface"><span class="secno">6.2.3</span> <span class="content">The Location interface</span></a>
       </ol>
      <li>
       <a href="#coop-browsing-contexts"><span class="secno">6.3</span> <span class="content">Browsing contexts</span></a>
       <ol class="toc">
        <li><a href="#coop-grouping-of-browsing-contexts"><span class="secno">6.3.1</span> <span class="content">Grouping of browsing contexts</span></a>
       </ol>
      <li><a href="#coop-agent-clusters"><span class="secno">6.4</span> <span class="content">Agents and agent clusters</span></a>
     </ol>
    <li>
     <a href="#security"><span class="secno">7</span> <span class="content">Security considerations</span></a>
     <ol class="toc">
      <li><a href="#same-origin-policy"><span class="secno">7.1</span> <span class="content">Same-origin policy</span></a>
      <li>
       <a href="#cross-origin-subframes-popup"><span class="secno">7.2</span> <span class="content">Cross-origin subframes opening popup</span></a>
       <ol class="toc">
        <li><a href="#requirements"><span class="secno">7.2.1</span> <span class="content">Requirements</span></a>
        <li><a href="#solution"><span class="secno">7.2.2</span> <span class="content">Solution</span></a>
        <li><a href="#origin-and-csp"><span class="secno">7.2.3</span> <span class="content">Origin and CSP</span></a>
       </ol>
      <li>
       <a href="#window-name-leakage"><span class="secno">7.3</span> <span class="content">Window.name leakage</span></a>
       <ol class="toc">
        <li><a href="#window-name-leak"><span class="secno">7.3.1</span> <span class="content">Window name leak</span></a>
        <li><a href="#short-term-mitigation"><span class="secno">7.3.2</span> <span class="content">Short term mitigation</span></a>
        <li><a href="#long-term-mitigation"><span class="secno">7.3.3</span> <span class="content">Long term mitigation</span></a>
       </ol>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="introduction"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#introduction"></a></h2>
   <p><em>This section is not normative.</em></p>
   <h3 class="heading settled" data-level="1.1" id="recommended-readings"><span class="secno">1.1. </span><span class="content">Recommended readings</span><a class="self-link" href="#recommended-readings"></a></h3>
   <ul>
    <li data-md>
     <p>The <a data-link-type="biblio" href="#biblio-spectre" title="Spectre Attacks: Exploiting Speculative Execution">[Spectre]</a> vulnerability.</p>
    <li data-md>
     <p>The <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#cross-origin-opener-policies" id="ref-for-cross-origin-opener-policies">Cross-Origin-Opener-Policy</a> (<a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#cross-origin-opener-policies" id="ref-for-cross-origin-opener-policies①">COOP</a>) section of the HTML spec.</p>
    <li data-md>
     <p>How and why <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#cross-origin-opener-policies" id="ref-for-cross-origin-opener-policies②">Cross-Origin-Opener-Policy</a> (<a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#cross-origin-opener-policies" id="ref-for-cross-origin-opener-policies③">COOP</a>) and <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coep" id="ref-for-coep">Cross-Origin-Embedder-Policy</a> (<a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coep" id="ref-for-coep①">COEP</a>) are granting the <a href="concept-settings-object-cross-origin-isolated-capability">crossOriginIsolated</a> capability. See <a data-link-type="biblio" href="#biblio-whycoopcoep" title="Why you need &quot;cross-origin isolated&quot; for powerful features">[WhyCoopCoep]</a>.</p>
   </ul>
   <h2 class="heading settled" data-level="2" id="problem"><span class="secno">2. </span><span class="content">A problem</span><a class="self-link" href="#problem"></a></h2>
   <p><em>This section is not normative.</em></p>
   <p>For pages to get <a href="concept-settings-object-cross-origin-isolated-capability">crossOriginIsolated</a> today, we require that <a data-link-type="dfn">COOP: same-origin</a>(<a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coop-same-origin" id="ref-for-coop-same-origin">coop-same-origin</a> be set. This
effectively prevents any interaction with third-party popups. This is
problematic for an important variety of use cases, below are a few real world
examples:</p>
   <ul>
    <li data-md>
     <p>gmail.com wants to do memory measurement to diagnose performance. Some emails
contain meet.com iframes which open a meeting when interacted with.</p>
    <li data-md>
     <p>zoom.com wants to use sharedArrayBuffers to reduce the copying of media data.
It needs to support being opened from third-party apps, via an SDK.</p>
    <li data-md>
     <p>perfetto.dev, a trace visualization app, would like to use a more accurate
performance.now() to improve performance. They use third-party popups to
display traces without having them sent to their server.</p>
    <li data-md>
     <p>construct.com, an online game engine needs javascript threading for
performance, but uses another domain for renderer game-preview popups.</p>
   </ul>
   <p>All of the aforementioned APIs are gated behind the <a href="concept-settings-object-cross-origin-isolated-capability">crossOriginIsolated</a> capability. This means that all of these websites cannot access them without
breaking their cross-origin popup flows.</p>
   <p>These restrictions are due to the <a data-link-type="biblio" href="#biblio-spectre" title="Spectre Attacks: Exploiting Speculative Execution">[Spectre]</a> vulnerability. Because of
Spectre, OS processes are now the only strong security boundary a browser can
enforce. <a href="concept-settings-object-cross-origin-isolated-capability">crossOriginIsolated</a> unlocks powerful APIs that make Spectre vulnerabilities easier to exploit. So
the browser need to be able to put crossOriginIsolated pages in their own
process based on top-level origin. To be able to honor that, <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#cross-origin-opener-policies" id="ref-for-cross-origin-opener-policies④">Cross-Origin-Opener-Policy</a> (<a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#cross-origin-opener-policies" id="ref-for-cross-origin-opener-policies⑤">COOP</a>) relies on <a data-link-type="dfn">BrowsingContext group</a> (<a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#browsing-context-group" id="ref-for-browsing-context-group">browsing-context-group</a>)
switches.</p>
   <p>A BrowsingContext (roughly a frame) belongs to a BrowsingContext group. All
documents presented in a BrowsingContext can communicate with other documents
presented in BrowsingContexts in the same BrowsingContext group via javascript.
Additionally, the BrowsingContext group holds a map of origins to Agent
Clusters. All same-origin documents in the same BrowsingContext group are in
the same Agent Cluster. They have synchronous scripting access to each other.
They need to be in the same process.</p>
   <p>If a browser does not support SiteIsolation, then all iframes have to be in the
process of the top-level frame. When any frame on the page opens a popup, the
popup also has to be put in the same process. This is because it could contain
frames that same-origin with frames on its opener page. These frames belong to
the same-agent cluster, and must be located in the same process to guarantee
synchronous DOM interactions. In practice, without SiteIsolation, all pages in
a Browsing context group resides in the same process, like in the example
below:</p>
   <p><img alt="payment flow" height="482" src="./resources/payment_flow.jpg" width="724"></p>
   <p>With COOP same-origin, we put the popup in a different BrowsingContext group.
Putting two documents in BrowsingContexts not belonging to the same
BrowsingContext group ensures they are not in the same Agent Cluster, therefore
that they do not need to be in the same process. This allows one of the
documents to safely enable crossOriginIsolation, since the browser is using two
different processes to isolate them.</p>
   <p><img alt="coop solution" height="325" src="./resources/coop_solution.jpg" width="1025"></p>
   <p>However, documents in different browsing context groups cannot communicate with
one other. So the payment flow in this example is broken. COOP
restrict-properties aims to preserve some of the communication while ensuring
that documents can be properly process isolated, even without SiteIsolation.</p>
   <h2 class="heading settled" data-level="3" id="explainer"><span class="secno">3. </span><span class="content">Explainer</span><a class="self-link" href="#explainer"></a></h2>
   <p><em>This section is not normative.</em></p>
   <h3 class="heading settled" data-level="3.1" id="coop-restrict-properties-proposal"><span class="secno">3.1. </span><span class="content">The COOP: restrict-properties proposal</span><a class="self-link" href="#coop-restrict-properties-proposal"></a></h3>
   <p>Instead of completely removing scripting capabilities between two pages, we
would like to only restrict synchronous access. This is what requires pages to
be in the same process. Making sure that two pages can never script each other
synchronously ensures that they can safely be put in different processes.</p>
   <p>The basic COOP: restrict-properties idea would be to use a single
BrowsingContext group, but to increase the keying of Agent Cluster. We would
have multiple same-origin documents not be able to synchronously script each
other, despite being able to reach each other’s Window object.</p>
   <p>Instead of increasing Agent Cluster keying, we introduce a new superset of
BrowsingContext group, the CrossOriginOpenerPolicy group. Within this new
group, pages have asynchronous access to each other. This gives us the
following multi-layer structure.</p>
   <p><img alt="coop group" height="715" src="./resources/coop_group.jpg" width="1047"></p>
   <p>Putting pages in a different BrowsingContext group but same COOP
BrowsingContext group would be done via a new COOP value, restrict-properties
that would only allow access to asynchronous properties. This makes it possible
to put the two pages in different processes, and to enable crossOriginIsolated
on the first page, as long as it also sets COEP.</p>
   <p>To reduce XS-leaks as much as possible, we reduce asynchronous
across-BrowsingContext groups to a very limited set of properties:
{window.closed and window.postMessage()}. This is based on metrics research
that shows that the overwhelming majority of sites only uses these two
properties when interacting with cross-origin popups. This prevents almost all
WindowProxy XS-Leaks.</p>
   <h3 class="heading settled" data-level="3.2" id="coop-rp-current-algo"><span class="secno">3.2. </span><span class="content">Fitting COOP: restrict-properties into current algorithm</span><a class="self-link" href="#coop-rp-current-algo"></a></h3>
   <p>The COOP algorithm works by comparing header values and origins to say compute
whether or not we should use a new BrowsingContext group. This needs to be
opened to an enum return value, containing the following possible outcomes:</p>
   <ol>
    <li data-md>
     <p>Stay in the same BrowsingContext group.</p>
    <li data-md>
     <p>Stay in the same COOP group, but change BrowsingContext group.</p>
    <li data-md>
     <p>Change COOP BrowsingContext group.</p>
   </ol>
   <p>Current COOP algorithm returns either 1. or 3. Using COOP: restrict-properties
would yield 2., iff:</p>
   <ul>
    <li data-md>
     <p>We are navigating between a page setting COOP: unsafe-none from/to a page
setting COOP: restrict-properties.</p>
    <li data-md>
     <p>We are navigating between two pages setting COOP: restrict-properties, but
that have different origins.</p>
    <li data-md>
     <p>We have a opened a fresh popup from a page that set COOP:
same-origin-allow-popups to a page that sets COOP: restrict-properties.</p>
   </ul>
   <h3 class="heading settled" data-level="3.3" id="extra-requirements"><span class="secno">3.3. </span><span class="content">Extra requirements for common use cases</span><a class="self-link" href="#extra-requirements"></a></h3>
   <p>We want COOP: restrict-properties to be as little intrusive as possible while
providing strong guarantees. Imagine the following use case: an authentication
provider uses a navigation flow to provide login with many different providers.
We do not want one of them setting COOP: restrict-properties limiting the
interactions between my-website.com and the provider.</p>
   <p><img alt="auth provider flow" height="374" src="./resources/auth_provider_flow.png" width="1090"></p>
   <p>In the above case, the navigation from auth-provider.com to google.auth.com
triggers a BrowsingContext group swap, within the same COOP group. We want to
make sure that the subsequent navigation from google.auth.com to
auth-provider.com reuses the same BrowsingContext group as the initial
auth-provider.com page, to reduce the impact of deploying COOP:
restrict-properties. We call that the reversibility requirement of COOP:
restrict-properties.</p>
   <p>To be able to do that, the COOP group needs to hold a map of BrowsingContext
groups, that they can reuse. This map is keyed by: {isCrossOriginIsolated,
hasCoopRestrictProperties, top-level origin or null}. This makes sure that:</p>
   <ul>
    <li data-md>
     <p>A crossOriginIsolated BrowsingContext group is never reused for another
origin, nor for a page that does not set COEP.</p>
    <li data-md>
     <p>A BrowsingContext group containing pages with COOP: restrict-properties is
not reused for another origin.</p>
    <li data-md>
     <p>All pages without COOP, within a COOP group, live in the same BrowsingContext
group.</p>
   </ul>
   <h2 class="heading settled" data-level="4" id="alternatives"><span class="secno">4. </span><span class="content">Alternatives considered</span><a class="self-link" href="#alternatives"></a></h2>
   <p><em>This section is not normative.</em></p>
   <h3 class="heading settled" data-level="4.1" id="extra-keying"><span class="secno">4.1. </span><span class="content">Extra-keying on Agent Clusters</span><a class="self-link" href="#extra-keying"></a></h3>
   <p>Instead of introducing the context of COOP groups to the spec, we could have
extended the Agent Cluster key in the following way - the agent cluster key is
either:</p>
   <ul>
    <li data-md>
     <p>a site</p>
    <li data-md>
     <p>a tuple origin</p>
    <li data-md>
     <p>a tuple containing an origin, a boolean (crossOriginIsolated) and another
origin (top-level origin)</p>
   </ul>
   <p>There is no web-observable behavior difference between this solution and the
one proposed in this spec. We do believe that having the COOP group notion
makes the spec easier to follow, which is why we’ve opted for it. It also
matches the underlying implementation better.</p>
   <h3 class="heading settled" data-level="4.2" id="same-origin-allow-popups-plus-coep"><span class="secno">4.2. </span><span class="content">COOP same-origin-allow-popups-plus-coep</span><a class="self-link" href="#same-origin-allow-popups-plus-coep"></a></h3>
   <p>It would be possible to extend Cross-Origin-Opener-Policy:
same-origin-allow-popups to provide the same guarantees as
Cross-Origin-Opener-Policy: restrict-properties in order to support
crossOrignIsolation. However, this has a few drawbacks. First, this can only be
done when a page also sets COEP. Otherwise, the compatibility risk on pages
already deploying COOP same-origin-allow-popups is too high. Second, it would
only allow openers of popups to be crossOriginIsolated, and not popups
themselves. Finally, COOP restrict-properties provides an easy to deploy
mitigation against most WindowProxy based XS-Leaks, that is valuable in itself
even outside the crossOriginIsolation paradigm.</p>
   <h2 class="heading settled" data-level="5" id="tests"><span class="secno">5. </span><span class="content">Tests</span><a class="self-link" href="#tests"></a></h2>
   <p>Status: <a href="https://wpt.fyi/results/html/cross-origin-opener-policy/tentative/restrict-properties">https://wpt.fyi/results/html/cross-origin-opener-policy/tentative/restrict-properties</a></p>
   <h2 class="heading settled" data-level="6" id="specification"><span class="secno">6. </span><span class="content">Specification</span><a class="self-link" href="#specification"></a></h2>
   <p>This section defines a monkey-patch over <a data-link-type="biblio" href="#biblio-html" title="HTML Standard">[HTML]</a>.</p>
   <h3 class="heading settled" data-level="6.1" id="cross-origin-opener-policies"><span class="secno">6.1. </span><span class="content">Cross-origin-opener-policies</span><a class="self-link" href="#cross-origin-opener-policies"></a></h3>
   <h4 class="heading settled" data-level="6.1.1" id="coop-values"><span class="secno">6.1.1. </span><span class="content">Cross-origin opener policy values</span><a class="self-link" href="#coop-values"></a></h4>
   <p>In the <a href="https://html.spec.whatwg.org/#cross-origin-opener-policies">cross-origin opener
policies</a> section,
extend the possible <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#cross-origin-opener-policy-value" id="ref-for-cross-origin-opener-policy-value">cross-origin opener polic values</a>:</p>
   <div class="monkey-patch">
     <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="coop-restrict-properties" data-noexport id="coop-restrict-properties">restrict-properties</dfn> 
    <p>This forces the <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document">document</a> and its child <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-document" id="ref-for-concept-document①">document</a> to use <a data-link-type="dfn" href="https://tc39.es/ecma262/multipage/executable-code-and-execution-contexts.html#sec-agent-clusters" id="ref-for-sec-agent-clusters">agent
clusters</a> keyed on top-level origin and <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#bcg-cross-origin-isolation" id="ref-for-bcg-cross-origin-isolation">cross-origin isolation mode</a>. It
also restricts the <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#the-window-proxy-exotic-object" id="ref-for-the-window-proxy-exotic-object">WindowProxy</a> methods available from <a data-link-type="dfn" href="https://tc39.es/ecma262/multipage/executable-code-and-execution-contexts.html#sec-agent-clusters" id="ref-for-sec-agent-clusters①">agent clusters</a> with a different top-level origin and <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#bcg-cross-origin-isolation" id="ref-for-bcg-cross-origin-isolation①">cross-origin isolation mode</a>.</p>
    <p><dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="coop-restrict-properties-plus-coep" data-noexport id="coop-restrict-properties-plus-coep">restrict-properties-plus-coep</dfn></p>
    <p>This behaves the same as "<a data-link-type="dfn" href="#coop-restrict-properties" id="ref-for-coop-restrict-properties">coop-restrict-properties</a>", with the addition that
it sets the <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#top-level-browsing-context" id="ref-for-top-level-browsing-context">top-level browsing context</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#browsing-context-group" id="ref-for-browsing-context-group①">group</a> <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#bcg-cross-origin-isolation" id="ref-for-bcg-cross-origin-isolation②">cross-origin isolation mode</a> to one of
"logical" or "concrete".</p>
   </div>
   <p>Extend the <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#cross-origin-opener-policy" id="ref-for-cross-origin-opener-policy">cross-origin opener policy</a> definition:</p>
   <div class="monkey-patch">
    <ul>
     <li data-md>
      <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="coop-origin" data-noexport id="coop-origin">COOP origin</dfn>, which is an <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#concept-origin" id="ref-for-concept-origin">origin</a>, initially the empty <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#concept-origin" id="ref-for-concept-origin①">origin</a>.</p>
    </ul>
   </div>
   <h4 class="heading settled" data-level="6.1.2" id="obtain-coop"><span class="secno">6.1.2. </span><span class="content">Obtaining a cross-origin opener policy</span><a class="self-link" href="#obtain-coop"></a></h4>
   <p>Modify the <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#obtain-coop" id="ref-for-obtain-coop">obtain a cross-origin opener policy</a>. First, add an origin parameter:</p>
   <div class="monkey-patch"> To <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#obtain-coop" id="ref-for-obtain-coop①">obtain a cross-origin opener policy</a> given a <a data-link-type="dfn" href="https://fetch.spec.whatwg.org/#concept-response" id="ref-for-concept-response">response</a> <em>response</em>, an <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#environment" id="ref-for-environment">environment</a> <em>reservedEnvironment</em>, and an <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#concept-origin" id="ref-for-concept-origin②">origin</a> <em>origin</em>: </div>
   <p>Then, add a step after step 4.1:</p>
   <div class="monkey-patch">
     4.2. If <em>parsedItem</em>[0] is "<a data-link-type="dfn" href="#coop-restrict-properties" id="ref-for-coop-restrict-properties①">restrict-properties</a>", then: 
    <ol>
     <li data-md>
      <p>Let <em>coep</em> be the result of <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#obtain-an-embedder-policy" id="ref-for-obtain-an-embedder-policy">obtaining a cross-origin embedder policy</a> from <em>response</em> and <em>reservedEnvironment</em>.</p>
     <li data-md>
      <p>If <em>coep</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#embedder-policy-value-2" id="ref-for-embedder-policy-value-2">value</a> is <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#compatible-with-cross-origin-isolation" id="ref-for-compatible-with-cross-origin-isolation">compatible with
 cross-origin isolation</a>, then set <em>policy</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#cross-origin-opener-policy-value" id="ref-for-cross-origin-opener-policy-value①">value</a> to
 "<a data-link-type="dfn" href="#coop-restrict-properties-plus-coep" id="ref-for-coop-restrict-properties-plus-coep">restrict-properties-plus-coep</a>.</p>
     <li data-md>
      <p>Otherwise, set <em>policy</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#cross-origin-opener-policy-value" id="ref-for-cross-origin-opener-policy-value②">value</a> to
 "<a data-link-type="dfn" href="#coop-restrict-properties" id="ref-for-coop-restrict-properties②">restrict-properties</a>.</p>
    </ol>
   </div>
   <p>Finally, add a step 5:</p>
   <div class="monkey-patch">
    <ol start="5">
     <li data-md>
      <p>Set <em>policy</em>'s <a data-link-type="dfn" href="#coop-origin" id="ref-for-coop-origin">COOP origin</a> to <em>origin</em>.</p>
    </ol>
   </div>
   <h4 class="heading settled" data-level="6.1.3" id="coop-bcg-switch"><span class="secno">6.1.3. </span><span class="content">Browsing context group switches due to cross-origin opener policy</span><a class="self-link" href="#coop-bcg-switch"></a></h4>
   <p>Add a new concept in the <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#browsing-context-group-switches-due-to-cross-origin-opener-policy" id="ref-for-browsing-context-group-switches-due-to-cross-origin-opener-policy">Browsing context group switches due to cross-origin
opener policy</a> part of the spec:</p>
   <div class="monkey-patch">
    <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="coop-enforcement-value" data-noexport id="coop-enforcement-value">cross-origin opener policy enforcement
value</dfn> indicates whether the enforcement of a <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#cross-origin-opener-policies" id="ref-for-cross-origin-opener-policies⑥">COOP</a> requires a browsing
context group switch and/or to restrict access to the browsing context inside
the browsing context group.</p>
    <p>A <a data-link-type="dfn" href="#coop-enforcement-value" id="ref-for-coop-enforcement-value">cross-origin opener policy value</a> has a boolean <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="coop-enforcement-value-switch" data-noexport id="coop-enforcement-value-switch">browsingContextGroupSwitchNeeded</dfn>,
initially false.</p>
    <p>A <a data-link-type="dfn" href="#coop-enforcement-value" id="ref-for-coop-enforcement-value①">cross-origin opener policy value</a> has an <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="coop-enforcement-value-key" data-noexport id="coop-enforcement-value-key">agentClusterKey</dfn>, which is null or a <a data-link-type="dfn" href="#coop-agent-cluster-key" id="ref-for-coop-agent-cluster-key">COOP agent cluster key</a>, initially null.</p>
   </div>
   <p>The algorithm to <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#check-browsing-context-group-switch-coop-value" id="ref-for-check-browsing-context-group-switch-coop-value">check if COOP values require a browsing context group switch</a> becomes:</p>
   <div class="monkey-patch">
    <ol>
     <li data-md>
      <p>let <em>coopEnforcementValue</em> be a new <a data-link-type="dfn" href="#coop-enforcement-value" id="ref-for-coop-enforcement-value②">cross-origin
 opener policy enforcement value</a>.</p>
     <li data-md>
      <p>If any of the following is true:</p>
      <ul>
       <li data-md>
        <p><em>responseCOOPValue</em> is "<a data-link-type="dfn" href="#coop-restrict-properties" id="ref-for-coop-restrict-properties③">restrict-properties</a>";</p>
       <li data-md>
        <p><em>responseCOOPValue</em> is
 "<a data-link-type="dfn" href="#coop-restrict-properties-plus-coep" id="ref-for-coop-restrict-properties-plus-coep①">restrict-properties-plus-coep</a>";</p>
       <li data-md>
        <p><em>activeDocumentCOOPValue</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#cross-origin-opener-policy-value" id="ref-for-cross-origin-opener-policy-value③">value</a> is
 "<a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coop-same-origin" id="ref-for-coop-same-origin①">same-origin</a>";</p>
       <li data-md>
        <p><em>activeDocumentCOOPValue</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#cross-origin-opener-policy-value" id="ref-for-cross-origin-opener-policy-value④">value</a> is
 "<a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coop-same-origin-plus-coep" id="ref-for-coop-same-origin-plus-coep">same-origin-plus-coep</a>";</p>
       <li data-md>
        <p><em>responseCOOPValue</em> is "<a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coop-same-origin" id="ref-for-coop-same-origin②">same-origin</a>";</p>
       <li data-md>
        <p><em>responseCOOPValue</em> is "<a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coop-same-origin-plus-coep" id="ref-for-coop-same-origin-plus-coep①">same-origin-plus-coep</a>";</p>
       <li data-md>
        <p>then:</p>
        <ol>
         <li data-md>
          <p>Let <em>needCrossOriginIsolation</em> be false.</p>
         <li data-md>
          <p>If <em>responseCOOPValue</em> is
  "<a data-link-type="dfn" href="#coop-restrict-properties-plus-coep" id="ref-for-coop-restrict-properties-plus-coep②">restrict-properties-plus-coep</a>"
  or <em>responseCOOPValue</em> is "<a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coop-same-origin-plus-coep" id="ref-for-coop-same-origin-plus-coep②">same-origin-plus-coep</a>", set <em>needCrossOriginIsolation</em> to true.</p>
         <li data-md>
          <p>Set <em>coopEnforcementValue</em>'s <a data-link-type="dfn" href="#coop-enforcement-value-key" id="ref-for-coop-enforcement-value-key">agentClusterKey</a> to [<em>responseOrigin</em>, <em>needCrossOriginIsolation</em>].</p>
        </ol>
      </ul>
     <li data-md>
      <p>If the result of <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#matching-coop" id="ref-for-matching-coop">matching</a> <em>activeDocumentCOOPValue</em>, <em>activeDocumentNavigationOrigin</em>, <em>responseCOOPValue</em>, and <em>responseOrigin</em> is
 true, return <em>coopEnforcementValue</em>.</p>
     <li data-md>
      <p>If all of the following are true:</p>
      <ul>
       <li data-md>
        <p><em>isInitialAboutBlank</em>;</p>
       <li data-md>
        <p><em>activeDocumentCOOPValue</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#cross-origin-opener-policy-value" id="ref-for-cross-origin-opener-policy-value⑤">value</a> is
 "<a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coop-same-origin-allow-popups" id="ref-for-coop-same-origin-allow-popups">same-origin-allow-popups</a>"; and</p>
       <li data-md>
        <p><em>responseCOOPValue</em> is not "<a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coop-same-origin" id="ref-for-coop-same-origin③">same-origin</a>" or
 "<a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coop-same-origin-plus-coep" id="ref-for-coop-same-origin-plus-coep③">same-origin-plus-coep</a>",</p>
       <li data-md>
        <p>then return <em>coopEnforcementValue</em>.</p>
      </ul>
     <li data-md>
      <p>If any of the following is true:</p>
      <ul>
       <li data-md>
        <p><em>activeDocumentCOOPValue</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#cross-origin-opener-policy-value" id="ref-for-cross-origin-opener-policy-value⑥">value</a> is
 "<a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coop-same-origin" id="ref-for-coop-same-origin④">same-origin</a>";</p>
       <li data-md>
        <p><em>activeDocumentCOOPValue</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#cross-origin-opener-policy-value" id="ref-for-cross-origin-opener-policy-value⑦">value</a> is
 "<a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coop-same-origin-plus-coep" id="ref-for-coop-same-origin-plus-coep④">same-origin-plus-coep</a>";</p>
       <li data-md>
        <p><em>responseCOOPValue</em> is "<a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coop-same-origin" id="ref-for-coop-same-origin⑤">same-origin</a>";</p>
       <li data-md>
        <p><em>responseCOOPValue</em> is "<a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coop-same-origin-plus-coep" id="ref-for-coop-same-origin-plus-coep⑤">same-origin-plus-coep</a>";</p>
       <li data-md>
        <p>then set <em>coopEnforcementValue</em>'s <a data-link-type="dfn" href="#coop-enforcement-value-switch" id="ref-for-coop-enforcement-value-switch">browsingContextGroupSwitchNeeded</a> to true.</p>
      </ul>
     <li data-md>
      <p>Return <em>coopEnforcementValue</em>.</p>
    </ol>
   </div>
   <p>The algorithm to <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#check-bcg-switch-report-only" id="ref-for-check-bcg-switch-report-only">check if enforcing report-only COOP would require a browsing
context group switch</a> becomes:</p>
   <div class="monkey-patch">
    <ol>
     <li data-md>
      <p>Let <em>coopEnforcementValue</em> be the result of <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#check-browsing-context-group-switch-coop-value" id="ref-for-check-browsing-context-group-switch-coop-value①">checking if COOP values
 require a browsing context group switch</a> given <em>isInitialAboutBlank</em>, <em>responseOrigin</em>, <em>activeDocumentNavigationOrigin</em>, <em>responseCOOP</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coop-struct-report-only-value" id="ref-for-coop-struct-report-only-value">report-only value</a> and <em>activeDocumentCOOPReportOnly</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coop-struct-report-only-value" id="ref-for-coop-struct-report-only-value①">report-only
 value</a>.</p>
     <li data-md>
      <p>If <em>coopEnforcementValue</em>'s <a data-link-type="dfn" href="#coop-enforcement-value-switch" id="ref-for-coop-enforcement-value-switch①">browsingContextGroupSwitchNeeded</a> is false, then return <em>coopEnforcementValue</em>.</p>
     <li data-md>
      <p>Let <em>activeDocumentReportOnlyCOOPEnforcementValue</em> be the result of <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#check-browsing-context-group-switch-coop-value" id="ref-for-check-browsing-context-group-switch-coop-value②">checking if COOP values require a browsing context group switch</a> given <em>isInitialAboutBlank</em>, <em>responseOrigin</em>, <em>activeDocumentNavigationOrigin</em>, <em>responseCOOP</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#cross-origin-opener-policy-value" id="ref-for-cross-origin-opener-policy-value⑧">value</a> and <em>activeDocumentCOOPReportOnly</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coop-struct-report-only-value" id="ref-for-coop-struct-report-only-value②">report-only value</a>.</p>
     <li data-md>
      <p>If <em>activeDocumentReportOnlyCOOPEnforcementValue</em>'s <a data-link-type="dfn" href="#coop-enforcement-value-switch" id="ref-for-coop-enforcement-value-switch②">browsingContextGroupSwitchNeeded</a> is true, then set <em>coopEnforcementValue</em>'s <a data-link-type="dfn" href="#coop-enforcement-value-switch" id="ref-for-coop-enforcement-value-switch③">browsingContextGroupSwitchNeeded</a> to true.</p>
     <li data-md>
      <p>Let <em>responseReportOnlyCOOPEnforcementValue</em> be the result of <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#check-browsing-context-group-switch-coop-value" id="ref-for-check-browsing-context-group-switch-coop-value③">checking if COOP values require a browsing context group switch</a> given <em>isInitialAboutBlank</em>, <em>responseOrigin</em>, <em>activeDocumentNavigationOrigin</em>, <em>responseCOOP</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coop-struct-report-only-value" id="ref-for-coop-struct-report-only-value③">report-only value</a> and <em>activeDocumentCOOPReportOnly</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#cross-origin-opener-policy-value" id="ref-for-cross-origin-opener-policy-value⑨">value</a>.</p>
     <li data-md>
      <p>If <em>responseReportOnlyCOOPEnforcementValue</em>'s <a data-link-type="dfn" href="#coop-enforcement-value-switch" id="ref-for-coop-enforcement-value-switch④">browsingContextGroupSwitchNeeded</a> is true, then set <em>coopEnforcementValue</em>'s <a data-link-type="dfn" href="#coop-enforcement-value-switch" id="ref-for-coop-enforcement-value-switch⑤">browsingContextGroupSwitchNeeded</a> to true.</p>
     <li data-md>
      <p>Return <em>coopEnforcementValue</em>.</p>
    </ol>
   </div>
   <p>Change the two first members of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coop-enforcement-result" id="ref-for-coop-enforcement-result">cross-origin opener policy enforcement result</a>:</p>
   <div class="monkey-patch">
    <ul>
     <li data-md>
      <p>A <a data-link-type="dfn" href="#coop-enforcement-value" id="ref-for-coop-enforcement-value③">COOP enforcement value</a> <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coop-enforcement-bcg-switch" id="ref-for-coop-enforcement-bcg-switch">needs a browsing context
group switch</a>.</p>
     <li data-md>
      <p>A <a data-link-type="dfn" href="#coop-enforcement-value" id="ref-for-coop-enforcement-value④">COOP enforcement value</a> <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coop-enforcement-bcg-switch-report-only" id="ref-for-coop-enforcement-bcg-switch-report-only">would need a browsing
context group switch due to report-only</a>.</p>
    </ul>
   </div>
   <p>Modify the <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coop-enforce" id="ref-for-coop-enforce">enforce a response’s cross-origin opener policy</a> algorithm:</p>
   <div class="monkey-patch">
    <ol start="4">
     <li data-md>
      <p>Let <em>newCOOPEnforcementResultValue</em>'s be the result of <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#check-browsing-context-group-switch-coop-value" id="ref-for-check-browsing-context-group-switch-coop-value④">checking if COOP values
 require a browsing context group switch</a> given <em>isInitialAboutBlank</em>, <em>currentCOOPEnforcementResult</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#cross-origin-opener-policy" id="ref-for-cross-origin-opener-policy①">cross-origin opener policy</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#cross-origin-opener-policy-value" id="ref-for-cross-origin-opener-policy-value①⓪">value</a>, <em>currentCOOPEnforcementResult</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#concept-origin" id="ref-for-concept-origin③">origin</a>, <em>responseCOOP</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#cross-origin-opener-policy-value" id="ref-for-cross-origin-opener-policy-value①①">value</a>, and <em>responseOrigin</em>.</p>
     <li data-md>
      <p>Set <em>newCOOPEnforcementResult</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coop-enforcement-bcg-switch" id="ref-for-coop-enforcement-bcg-switch①">needs a browsing context group
 switch</a>'s <a data-link-type="dfn" href="#coop-enforcement-value-key" id="ref-for-coop-enforcement-value-key①">agentClusterKey</a> to <em>newCOOPEnforcementResultValue</em>'s <a data-link-type="dfn" href="#coop-enforcement-value-key" id="ref-for-coop-enforcement-value-key②">agentClusterKey</a>.</p>
     <li data-md>
      <p>If <em>newCOOPEnforcementResultValue</em>'s <a data-link-type="dfn" href="#coop-enforcement-value-switch" id="ref-for-coop-enforcement-value-switch⑥">browsingContextGroupSwitchNeeded</a> is true, then:</p>
      <ol>
       <li data-md>
        <p>Set <em>newCOOPEnforcementResult</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coop-enforcement-bcg-switch" id="ref-for-coop-enforcement-bcg-switch②">needs a browsing context group
  switch</a>'s <a data-link-type="dfn" href="#coop-enforcement-value-switch" id="ref-for-coop-enforcement-value-switch⑦">browsingContextGroupSwitchNeeded</a> to true.</p>
       <li data-md>
        <p>If <em>browsingContext</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#browsing-context-group" id="ref-for-browsing-context-group②">group</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#browsing context set" id="ref-for-browsing context set">browsing context
  set</a>'s <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-size" id="ref-for-list-size">size</a> is greater than 1, then:</p>
        <ol>
         <li data-md>
          <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coop-violation-navigation-to" id="ref-for-coop-violation-navigation-to">Queue a violation report for browsing context group switch when
 navigating to a COOP response</a> with <em>responseCOOP</em>, "<em>enforce</em>", <em>responseURL</em>, <em>currentCOOPEnforcementResult</em>'s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url">url</a>, <em>currentCOOPEnforcementResult</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#concept-origin" id="ref-for-concept-origin④">origin</a>, <em>responseOrigin</em>, and <em>referrer</em>.</p>
         <li data-md>
          <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coop-violation-navigation-from" id="ref-for-coop-violation-navigation-from">Queue a violation report for browsing context group switch when
 navigating away from a COOP response</a> with <em>currentCOOPEnforcementResult</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#cross-origin-opener-policy" id="ref-for-cross-origin-opener-policy②">cross-origin opener policy</a>'s , "<em>enforce</em>", <em>currentCOOPEnforcementResult</em>'s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url①">url</a>, <em>responseURL</em>, <em>currentCOOPEnforcementResult</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coop-enforcement-origin" id="ref-for-coop-enforcement-origin">origin</a>, <em>responseOrigin</em>, and <em>currentCOOPEnforcementResult</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coop-enforcement-source" id="ref-for-coop-enforcement-source">current context is navigation source</a>.</p>
        </ol>
      </ol>
     <li data-md>
      <p>Let <em>newCOOPEnforcementResultReportOnlyValue</em> be the result of <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#check-bcg-switch-report-only" id="ref-for-check-bcg-switch-report-only①">checking if
 enforcing report-only COOP would require a browsing context group switch</a> given <em>isInitialAboutBlank</em>, <em>responseOrigin</em>, <em>currentCOOPEnforcementResult</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#concept-origin" id="ref-for-concept-origin⑤">origin</a>, <em>responseCOOP</em>, and <em>currentCOOPEnforcementResult</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#cross-origin-opener-policy" id="ref-for-cross-origin-opener-policy③">cross-origin opener policy</a>.</p>
     <li data-md>
      <p>Set <em>newCOOPEnforcementResult</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coop-enforcement-bcg-switch-report-only" id="ref-for-coop-enforcement-bcg-switch-report-only①">would need a browsing context group
 switch due to report-only</a>'s <a data-link-type="dfn" href="#coop-enforcement-value-key" id="ref-for-coop-enforcement-value-key③">agentClusterKey</a> to <em>newCOOPEnforcementResultReportOnlyValue</em>'s <a data-link-type="dfn" href="#coop-enforcement-value-key" id="ref-for-coop-enforcement-value-key④">agentClusterKey</a>.</p>
     <li data-md>
      <p>If <em>newCOOPEnforcementResultReportOnlyValue</em>'s <a data-link-type="dfn" href="#coop-enforcement-value-switch" id="ref-for-coop-enforcement-value-switch⑧">browsingContextGroupSwitchNeeded</a> is true, then:</p>
      <ol>
       <li data-md>
        <p>Set <em>newCOOPEnforcementResult</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coop-enforcement-bcg-switch-report-only" id="ref-for-coop-enforcement-bcg-switch-report-only②">would need a browsing context group
  switch due to report-only</a>'s <a data-link-type="dfn" href="#coop-enforcement-value-switch" id="ref-for-coop-enforcement-value-switch⑨">browsingContextGroupSwitchNeeded</a> to true.</p>
       <li data-md>
        <p>If <em>browsingContext</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#browsing-context-group" id="ref-for-browsing-context-group③">group</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#browsing context set" id="ref-for-browsing context set①">browsing context
  set</a>'s <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list-size" id="ref-for-list-size①">size</a> is greater than 1, then:</p>
        <ol>
         <li data-md>
          <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coop-violation-navigation-to" id="ref-for-coop-violation-navigation-to①">Queue a violation report for browsing context group switch when
 navigating to a COOP response</a> with <em>responseCOOP</em>, "<em>reporting</em>", <em>responseURL</em>, <em>currentCOOPEnforcementResult</em>'s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url②">url</a>, <em>currentCOOPEnforcementResult</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#concept-origin" id="ref-for-concept-origin⑥">origin</a>, <em>responseOrigin</em>, and <em>referrer</em>.</p>
         <li data-md>
          <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coop-violation-navigation-from" id="ref-for-coop-violation-navigation-from①">Queue a violation report for browsing context group switch when
 navigating away from a COOP response</a> with <em>currentCOOPEnforcementResult</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#cross-origin-opener-policy" id="ref-for-cross-origin-opener-policy④">cross-origin opener policy</a>'s , "<em>reporting</em>", <em>currentCOOPEnforcementResult</em>'s <a data-link-type="dfn" href="https://url.spec.whatwg.org/#concept-url" id="ref-for-concept-url③">url</a>, <em>responseURL</em>, <em>currentCOOPEnforcementResult</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coop-enforcement-origin" id="ref-for-coop-enforcement-origin①">origin</a>, <em>responseOrigin</em>, and <em>currentCOOPEnforcementResult</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coop-enforcement-source" id="ref-for-coop-enforcement-source①">current context is navigation source</a>.</p>
        </ol>
      </ol>
     <li data-md>
      <p>Return <em>newCOOPEnforcementResult</em>.</p>
    </ol>
   </div>
   <p>The <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#obtain-browsing-context-navigation" id="ref-for-obtain-browsing-context-navigation">obtain a browsing context to use for a navigation response</a> becomes:</p>
   <div class="monkey-patch">
    <ol>
     <li data-md>
      <p>If <em>browsingContext</em> is not a <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#top-level-browsing-context" id="ref-for-top-level-browsing-context①">top-level browsing context</a>, then return <em>browsingContext</em>.</p>
     <li data-md>
      <p>Let <em>navigationBrowsingContext</em> be null.</p>
     <li data-md>
      <p>If <em>coopEnforcementResult</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coop-enforcement-bcg-switch" id="ref-for-coop-enforcement-bcg-switch③">needs a browsing context group switch</a>'s <a data-link-type="dfn" href="#coop-enforcement-value-switch" id="ref-for-coop-enforcement-value-switch①⓪">browsingContextGroupSwitchNeeded</a> is false, then:</p>
      <ol>
       <li data-md>
        <p>If <em>coopEnforcementResult</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coop-enforcement-bcg-switch-report-only" id="ref-for-coop-enforcement-bcg-switch-report-only③">would need a browsing context group switch due
  to report-only</a>'s <a data-link-type="dfn" href="#coop-enforcement-value-switch" id="ref-for-coop-enforcement-value-switch①①">browsingContextGroupSwitchNeeded</a> is true, set <em>browsingContext</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#virtual-browsing-context-group-id" id="ref-for-virtual-browsing-context-group-id">virtual browsing context group ID</a> to a new unique identifier.</p>
       <li data-md>
        <p>Set <em>navigationBrowsingContext</em> to <em>browsingContext</em>.</p>
      </ol>
     <li data-md>
      <p>Else:</p>
      <ol>
       <li data-md>
        <p>Set <em>navigationBrowsingContext</em> to the first return value of <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#creating-a-new-top-level-browsing-context" id="ref-for-creating-a-new-top-level-browsing-context">creating a new
  top-level browsing context and document</a>.</p>
       <li data-md>
        <p>If <em>sandboxFlags</em> is not empty, then:</p>
        <ol>
         <li data-md>
          <p>Assert <em>navigationCOOP</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#cross-origin-opener-policy-value" id="ref-for-cross-origin-opener-policy-value①②">value</a> is
 one of "<a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coop-unsafe-none" id="ref-for-coop-unsafe-none">unsafe-none</a>", "<a data-link-type="dfn" href="#coop-restrict-properties" id="ref-for-coop-restrict-properties④">restrict-properties</a>", or
 "<a data-link-type="dfn" href="#coop-restrict-properties-plus-coep" id="ref-for-coop-restrict-properties-plus-coep③">restrict-properties-plus-coep</a>".</p>
         <li data-md>
          <p>Assert <em>navigationBrowsingContext</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#popup-sandboxing-flag-set" id="ref-for-popup-sandboxing-flag-set">popup sandboxing flag set</a> is empty.</p>
         <li data-md>
          <p>Set <em>navigationBrowsingContext</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#popup-sandboxing-flag-set" id="ref-for-popup-sandboxing-flag-set①">popup sandboxing flag set</a> to a clone of <em>sandboxFlags</em>.</p>
        </ol>
      </ol>
     <li data-md>
      <p>Set <em>navigationBrowsingContext</em>'s <a data-link-type="dfn" href="#bcg-coop-agent-cluster-key" id="ref-for-bcg-coop-agent-cluster-key">COOP agent
 cluster key</a> to <em>coopEnforcementResult</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coop-enforcement-bcg-switch" id="ref-for-coop-enforcement-bcg-switch④">needs a browsing context group
 switch</a>'s <a data-link-type="dfn" href="#coop-enforcement-value-key" id="ref-for-coop-enforcement-value-key⑤">agentClusterKey</a>.</p>
     <li data-md>
      <p>Set <em>navigationBrowsingContext</em>'s <a data-link-type="dfn" href="#virtual-coop-agent-cluster-key" id="ref-for-virtual-coop-agent-cluster-key">virtual
 COOP agent cluster key</a> to <em>coopEnforcementResult</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coop-enforcement-bcg-switch-report-only" id="ref-for-coop-enforcement-bcg-switch-report-only④">would need a browsing
 context group switch due to report-only</a>'s <a data-link-type="dfn" href="#coop-enforcement-value-key" id="ref-for-coop-enforcement-value-key⑥">agentClusterKey</a>.</p>
     <li data-md>
      <p>Return <em>navigationBrowsingContext</em>.</p>
    </ol>
   </div>
   <h4 class="heading settled" data-level="6.1.4" id="coop-reporting"><span class="secno">6.1.4. </span><span class="content">Reporting</span><a class="self-link" href="#coop-reporting"></a></h4>
   <p>Modify step 8 of the algorithm to <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coop-check-access-report" id="ref-for-coop-check-access-report">check if an access between two browsing
contexts should be reported</a> algorithm:</p>
   <div class="monkey-patch">
    <ol start="8">
     <li data-md>
      <p>If <em>accessor</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#top-level-browsing-context" id="ref-for-top-level-browsing-context②">top-level browsing context</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#virtual-browsing-context-group-id" id="ref-for-virtual-browsing-context-group-id①">virtual browsing context
 group ID</a> is <em>accessed</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#top-level-browsing-context" id="ref-for-top-level-browsing-context③">top-level browsing context</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#virtual-browsing-context-group-id" id="ref-for-virtual-browsing-context-group-id②">virtual browsing
 context group ID</a>, then:</p>
      <ol>
       <li data-md>
        <p>If <em>accessor</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#top-level-browsing-context" id="ref-for-top-level-browsing-context④">top-level browsing context</a>'s <a data-link-type="dfn" href="#virtual-coop-agent-cluster-key" id="ref-for-virtual-coop-agent-cluster-key①">virtual COOP agent cluster key</a> is <em>accessed</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#top-level-browsing-context" id="ref-for-top-level-browsing-context⑤">top-level browsing context</a>'s <a data-link-type="dfn" href="#virtual-coop-agent-cluster-key" id="ref-for-virtual-coop-agent-cluster-key②">virtual COOP agent cluster key</a>, then
  return.</p>
       <li data-md>
        <p>If P is an <a data-link-type="dfn" href="#unrestricted-cross-origin-property-name" id="ref-for-unrestricted-cross-origin-property-name">unrestricted
  cross-origin accessible window property name</a>, then return.</p>
      </ol>
    </ol>
   </div>
   <h3 class="heading settled" data-level="6.2" id="coop-navigation-apis"><span class="secno">6.2. </span><span class="content">APIs related to navigation and session history</span><a class="self-link" href="#coop-navigation-apis"></a></h3>
   <h4 class="heading settled" data-level="6.2.1" id="coop-security-infracstructure"><span class="secno">6.2.1. </span><span class="content">Security infrastructure for Window, WindowProxy, and Location objects</span><a class="self-link" href="#coop-security-infracstructure"></a></h4>
   <p>Add one argument to the <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#crossorigingetownpropertyhelper-(-o,-p-)" id="ref-for-crossorigingetownpropertyhelper-(-o,-p-)">CrossOriginGetOwnPropertyHelper</a> algorithm:</p>
   <div class="monkey-patch">
    <p>7.2.1.3.4 CrossOriginGetOWnPropertyHelper(O,P,hasSameCOOPKey)</p>
   </div>
   <p>Replace step 1 and 2 of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#crossorigingetownpropertyhelper-(-o,-p-)" id="ref-for-crossorigingetownpropertyhelper-(-o,-p-)①">CrossOriginGetOwnPropertyHelper</a> algorithm:</p>
   <div class="monkey-patch">
    <ol>
     <li data-md>
      <p>Let <em>crossOriginKey</em> be a tuple consisting of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#current-settings-object" id="ref-for-current-settings-object">current settings object</a>,
 O’s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object" id="ref-for-relevant-settings-object">relevant settings object</a>, P, and isCrossBrowsingContext.</p>
     <li data-md>
      <p>Let <em>propertyList</em> be null.</p>
     <li data-md>
      <p>If <em>hasSameCOOPKey</em> is true, set <em>propertyLisy</em> to <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#crossoriginproperties-(-o-)" id="ref-for-crossoriginproperties-(-o-)">CrossOriginProperties</a>(O).</p>
     <li data-md>
      <p>Else, set <em>propertyList</em> to <a data-link-type="dfn" href="#unrestricted-cross-origin-properties" id="ref-for-unrestricted-cross-origin-properties">UnrestrictedCrossOriginProperties</a>(O).</p>
     <li data-md>
      <p>For each <em>e</em> of <em>propertyList</em>:</p>
    </ol>
   </div>
   <h4 class="heading settled" data-level="6.2.2" id="coop-window-proxy"><span class="secno">6.2.2. </span><span class="content">The WindowProxy exotic object</span><a class="self-link" href="#coop-window-proxy"></a></h4>
   <p>Add a step to the <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#windowproxy-get" id="ref-for-windowproxy-get">Get</a> algorithm:</p>
   <div class="monkey-patch">
    <ol start="3">
     <li data-md>
      <p>If <a data-link-type="dfn" href="#windowproxy-same-coop-key" id="ref-for-windowproxy-same-coop-key">WindowProxyHasSameCOOPKey(W)</a> is
 false, then return ? <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#crossoriginget-(-o,-p,-receiver-)" id="ref-for-crossoriginget-(-o,-p,-receiver-)">CrossOriginGet</a>(this, P, V, receiver).</p>
    </ol>
   </div>
   <p>Add a step to the <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#windowproxy-set" id="ref-for-windowproxy-set">Set</a> algorithm:</p>
   <div class="monkey-patch">
    <ol start="3">
     <li data-md>
      <p>If <a data-link-type="dfn" href="#windowproxy-same-coop-key" id="ref-for-windowproxy-same-coop-key①">WindowProxyHasSameCOOPKey(W)</a> is
 false, then return ? <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#crossoriginset-(-o,-p,-receiver-)" id="ref-for-crossoriginset-(-o,-p,-receiver-)">CrossOriginSet</a>(this, P, V, receiver).</p>
    </ol>
   </div>
   <p>Add a step to the WindowProxy <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#windowproxy-getownproperty" id="ref-for-windowproxy-getownproperty">GetOwnProperty</a> algorithm:</p>
   <div class="monkey-patch">
    <ol start="2">
     <li data-md>
      <p>If <a data-link-type="dfn" href="#windowproxy-same-coop-key" id="ref-for-windowproxy-same-coop-key②">WindowProxyHasSameCOOPKey(W)</a> is
 false, then:</p>
      <ol>
       <li data-md>
        <p>Let <em>property</em> be <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#crossorigingetownpropertyhelper-(-o,-p-)" id="ref-for-crossorigingetownpropertyhelper-(-o,-p-)②">CrossOriginGetOwnPropertyHelper</a>(W,P, false).</p>
       <li data-md>
        <p>If <em>property</em> is not undefined, then return <em>property</em>.</p>
       <li data-md>
        <p>Throw a "<a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#LegacyUnenumerableNamedPropertiessecurityerror" id="ref-for-LegacyUnenumerableNamedPropertiessecurityerror">SecurityError</a>" <a data-link-type="dfn" href="https://webidl.spec.whatwg.org/#LegacyUnenumerableNamedPropertiesdfn-DOMException" id="ref-for-LegacyUnenumerableNamedPropertiesdfn-DOMException">DOMException</a>.</p>
      </ol>
    </ol>
   </div>
   <p>Modify step 4 of the WindowProxy <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#windowproxy-getownproperty" id="ref-for-windowproxy-getownproperty①">GetOwnProperty</a> algorithm:</p>
   <div class="monkey-patch">
    <ol start="4">
     <li data-md>
      <p>Let <em>property</em> be <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#crossorigingetownpropertyhelper-(-o,-p-)" id="ref-for-crossorigingetownpropertyhelper-(-o,-p-)③">CrossOriginGetOwnPropertyHelper</a>(W,P, true).</p>
    </ol>
   </div>
   <p>Add the following to the <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#the-window-proxy-exotic-object" id="ref-for-the-window-proxy-exotic-object①">WindowProxy</a> section:</p>
   <div class="monkey-patch">
    <p>7.2.3.11 <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="unrestricted-cross-origin-properties" data-noexport id="unrestricted-cross-origin-properties">UnrestrictedCrossOriginProperties(W)</dfn></p>
    <ol>
     <li data-md>
      <p>Return { [Property]: "<em>closed</em>", [NeedsGet]: true, [NeedsSet]:
  false }, { [Property]: "<em>postMessage</em>" } ».</p>
    </ol>
    <p>A Javascript property name P is a <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="unrestricted-cross-origin-property-name" data-noexport id="unrestricted-cross-origin-property-name">unrestricted cross-origin
accessible window property name</dfn> if it is "<em>closed</em>" or "<em>postMessage</em>".</p>
    <p>7.2.3.12 <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="windowproxy-same-coop-key" data-noexport id="windowproxy-same-coop-key">WindowProxyHasSameCOOPKey(W)</dfn></p>
    <ol>
     <li data-md>
      <p>Return true if the <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#current-global-object" id="ref-for-current-global-object">current global object</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-bc" id="ref-for-window-bc">browsing
        context</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#top-level-browsing-context" id="ref-for-top-level-browsing-context⑥">top-level browsing context</a>'s <a data-link-type="dfn" href="#bcg-coop-agent-cluster-key" id="ref-for-bcg-coop-agent-cluster-key①">COOP
        agent cluster key</a> is <em>W</em>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-bc" id="ref-for-window-bc①">browsing
        context</a>'s <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#top-level-browsing-context" id="ref-for-top-level-browsing-context⑦">top-level browsing context</a>'s <a data-link-type="dfn" href="#bcg-coop-agent-cluster-key" id="ref-for-bcg-coop-agent-cluster-key②">COOP
        agent cluster key</a>.</p>
    </ol>
   </div>
   <h4 class="heading settled" data-level="6.2.3" id="coop-location-interface"><span class="secno">6.2.3. </span><span class="content">The Location interface</span><a class="self-link" href="#coop-location-interface"></a></h4>
   <p>Modify step 2 of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#location-getownproperty" id="ref-for-location-getownproperty">GetOwnProperty</a> algorithm:</p>
   <div class="monkey-patch">
    <ol start="2">
     <li data-md>
      <p>Let <em>property</em> be <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#crossorigingetownpropertyhelper-(-o,-p-)" id="ref-for-crossorigingetownpropertyhelper-(-o,-p-)④">CrossOriginGetOwnPropertyHelper</a>(this,P, true).</p>
    </ol>
   </div>
   <h3 class="heading settled" data-level="6.3" id="coop-browsing-contexts"><span class="secno">6.3. </span><span class="content">Browsing contexts</span><a class="self-link" href="#coop-browsing-contexts"></a></h3>
   <p>Add two new members to the definition of <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-bc" id="ref-for-window-bc②">browsing context</a>:</p>
   <div class="monkey-patch">
    <ul>
     <li data-md>
      <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="bcg-coop-agent-cluster-key" data-noexport id="bcg-coop-agent-cluster-key">COOP agent cluster key</dfn>, which is
null or a <a data-link-type="dfn" href="#coop-agent-cluster-key" id="ref-for-coop-agent-cluster-key①">COOP agent cluster key</a>, initially null.</p>
     <li data-md>
      <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="virtual-coop-agent-cluster-key" data-noexport id="virtual-coop-agent-cluster-key">virtual COOP agent cluster
key</dfn>, which is null or null or a <a data-link-type="dfn" href="#coop-agent-cluster-key" id="ref-for-coop-agent-cluster-key②">COOP agent
cluster key</a>, initially null. This is used by <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#coop-struct-report-only-value" id="ref-for-coop-struct-report-only-value④">cross-origin
opener policy reporting</a>, to keep track of the changes to agent cluster keying
that would have happened if the report-only policy had been enforced.</p>
    </ul>
   </div>
   <h4 class="heading settled" data-level="6.3.1" id="coop-grouping-of-browsing-contexts"><span class="secno">6.3.1. </span><span class="content">Grouping of browsing contexts</span><a class="self-link" href="#coop-grouping-of-browsing-contexts"></a></h4>
   <h3 class="heading settled" data-level="6.4" id="coop-agent-clusters"><span class="secno">6.4. </span><span class="content">Agents and agent clusters</span><a class="self-link" href="#coop-agent-clusters"></a></h3>
   <p>Add the following to the <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#integration-with-the-javascript-agent-cluster-formalism" id="ref-for-integration-with-the-javascript-agent-cluster-formalism">Integration with the JavaScript agent cluster
formalism</a>:</p>
   <div class="monkey-patch">
    <p>A <dfn class="dfn-paneled" data-dfn-type="dfn" data-lt="coop-agent-cluster-key" data-noexport id="coop-agent-cluster-key">COOP agent cluster key</dfn> is a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#tuple" id="ref-for-tuple">tuple</a> of an <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#concept-origin" id="ref-for-concept-origin⑦">origin</a> and a <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#bcg-cross-origin-isolation" id="ref-for-bcg-cross-origin-isolation③">cross-origin isolation mode</a>.</p>
   </div>
   <p>Change the definition of the <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#agent-cluster-key" id="ref-for-agent-cluster-key">agent cluster key</a>:</p>
   <div class="monkey-patch">
    <p>An <a data-link-type="dfn" href="https://html.spec.whatwg.org/C/#agent-cluster-key" id="ref-for-agent-cluster-key①">agent cluster key</a> is either a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#site" id="ref-for-site">site</a>, or a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-tuple" id="ref-for-concept-origin-tuple">tuple origin</a>, or a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#tuple" id="ref-for-tuple①">tuple</a> of a <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-tuple" id="ref-for-concept-origin-tuple①">tuple origin</a> and a <a data-link-type="dfn" href="#coop-agent-cluster-key" id="ref-for-coop-agent-cluster-key③">COOP agent
cluster key</a>.</p>
   </div>
   <h2 class="heading settled" data-level="7" id="security"><span class="secno">7. </span><span class="content">Security considerations</span><a class="self-link" href="#security"></a></h2>
   <h3 class="heading settled" data-level="7.1" id="same-origin-policy"><span class="secno">7.1. </span><span class="content">Same-origin policy</span><a class="self-link" href="#same-origin-policy"></a></h3>
   <p>Our proposal creates an unprecedented possibility: that two same-origin
documents can reach one another but not have full access to each other. We
audited the spec to produce a list of all places with same-origin checks
relying on the assumption of full access. Some points worthy of attention:</p>
   <ul>
    <li data-md>
     <p>The location object is quite sensitive and many of its methods/members are
same-origin only. It is purposefully excluded from the list of allowed
attributes by restrict-properties. We do not think we should allow a normal
page to navigate a crossOriginIsolated page.</p>
    <li data-md>
     <p>For similar reasons name targeting does not work across pages with COOP:
restrict-properties.</p>
    <li data-md>
     <p>Javascript navigations are a big NO. They mean executing arbitrary javascript
within the target frame. There should be no way to navigate a frame across
the COOP: restrict-properties boundary given the restrictions above are put in
place.</p>
   </ul>
   <h3 class="heading settled" data-level="7.2" id="cross-origin-subframes-popup"><span class="secno">7.2. </span><span class="content">Cross-origin subframes opening popup</span><a class="self-link" href="#cross-origin-subframes-popup"></a></h3>
   <p>What happens when an iframe in a <code>COOP</code> page opens a popup? The initial empty
document created always inherits the origin of the iframe, while we would like <code>COOP</code> to be inherited from the top-level document. This can create dangerous
discrepencies where we end up with a <code>crossOriginIsolated</code> initial empty
document of an arbitrary origin.</p>
   <p>For <code>COOP: same-origin</code> we solved this problem by setting no-opener on any
popup opened from an iframe that is cross-origin to its top-level document.</p>
   <h4 class="heading settled" data-level="7.2.1" id="requirements"><span class="secno">7.2.1. </span><span class="content">Requirements</span><a class="self-link" href="#requirements"></a></h4>
   <p>For COOP: restrict-properties to work, we need:</p>
   <ul>
    <li data-md>
     <p>To be able to work with cross-origin iframes opening popups. These are common
in the flow we’re trying to address.</p>
    <li data-md>
     <p>To use the standard COOP comparison rules for freshly opened popups on their
first navigation. Currently we do not inherit COOP for fresh popups opened by
cross-origin iframes. So it is always <code>unsafe-none</code> to X. This works for
current COOP values:</p>
     <ul>
      <li data-md>
       <p><code>same-origin-allow-popups</code> behaves like <code>unsafe-none</code> with freshly opened popups.</p>
      <li data-md>
       <p><code>same-origin</code> opens such popups with no-opener.</p>
      <li data-md>
       <p>It does not work with COOP: <code>restrict-properties</code> because we need to swap
against <code>unsafe-none</code>.</p>
     </ul>
   </ul>
   <p>We do not currently inherit COOP because it would mix the origin, inherited
from the iframe, with the COOP value, inherited from the top-level document.</p>
   <p>!<a href="../resources/coop_inheritance_issue.jpg">image</a> <em>By simply inheriting, we break COOP. In this example, everything lives in the
same process, which should never be allowed.</em></p>
   <p>We use noopener because an initial empty documents from a different origin in
the same browsing context group, if crossOriginIsolated, could read the
top-level origin, bypassing the PermissionsPolicy that might have been set on
the iframe.</p>
   <p><img alt="coop inheritance permission bypass" height="489" src="./resources/coop_inheritance_permission_bypass.jpg" width="947"></p>
   <p><em>By not using noopener, we’ve allowed the iframe to exploit crossOriginIsolated
APIs, bypassing the PermissionsPolicy set by the embedder.</em></p>
   <h4 class="heading settled" data-level="7.2.2" id="solution"><span class="secno">7.2.2. </span><span class="content">Solution</span><a class="self-link" href="#solution"></a></h4>
   <p>Our solution is to supplement the COOP structure with the origin that initially
set it. This way we prevent the mix-up of origins and COOP value. The COOP
origin is used exclusively by the COOP algorithm. Initial empty documents that
do not have matching origin and COOP origin cannot use crossOriginIsolated
APIs.</p>
   <p><img alt="coop inheritance proposal" height="742" src="./resources/coop_inheritance_proposal.jpg" width="947"></p>
   <p><em>By supplementing COOP with the setting origin, we are able to correctly
separate the two end pages in two distinct browsing context groups. The initial
empty document still lives in the opener browsing context group but might not
use CrossOriginIsolated APIs.</em></p>
   <p>We also wanted to add some details about the crossOriginIsolated APIs
restriction for pages with mismatched COOP origin and origin. Below are all the
different inherited pieces of the puzzle:</p>
   <p><img alt="coop inheritance coep1" height="488" src="./resources/coop_inheritance_coep_1.jpg" width="947"></p>
   <p><em>COOP is inherited from the top-level opener browsing context. COEP gets passed
to the initial empty document because the iframe set it. crossOriginIsolated
permission is none because COOP origin and origin do not match.</em></p>
   <p>In this example, we have documents with different top-level origins in a
BrowsingContext group that is crossOriginIsolated. This was not initially
possible, but we believe this is fine:</p>
   <ul>
    <li data-md>
     <p>Anything that the iframe does is readable by a.com. This is fine because
b.com agreed to that by setting COEP. The fresh popup is required to be
in-process, and anything done in there can be read by a.com. A.com cannot get
any extra information, because the top-level frame behaves like the iframe. It
has COEP so it cannot do new embedding, it has the same origin so it cannot do
extra fetches, etc.</p>
    <li data-md>
     <p>In the other direction, b.com can read a.com if the Permissions-Policy is
delegated to the iframe. Permissions-Policy is not inherited. For this reason
we explicitely disable crossOriginIsolated permission on all freshly opened
popups, as it would otherwise default to <code>allow</code>.</p>
    <li data-md>
     <p>COOP invariants about top-level origins become invariants about top-level
COOP origins. The only case where a page can have a COOP origin not equal to
its actual origin is the initial empty document.</p>
   </ul>
   <p>Finally, a note about the following situation:</p>
   <p><img alt="coop inheritance coep2" height="747" src="./resources/coop_inheritance_coep_2.jpg" width="948"></p>
   <p><em>COEP gets inherited to the popup although only the iframe set it and its
top-level document did not. The iframe is NOT crossOriginIsolated.</em></p>
   <p>We’ve simplified the COOP value in the drawings. In reality it is augmented
with COEP when it is received from the network, and used alone in the COOP
algorithm. In the above picture it still works as intended, because we’re
inheriting COOP: "restrict-properties" and not "restrict-properties+COEP".</p>
   <h4 class="heading settled" data-level="7.2.3" id="origin-and-csp"><span class="secno">7.2.3. </span><span class="content">Origin and CSP</span><a class="self-link" href="#origin-and-csp"></a></h4>
    Because we’re recording the origin along the COOP value, we need to decide what
to do with sandboxing, which can make the origin opaque. The current spec
mentions that we first compute the sandboxing flags, both inherited and set via
CSP, and then if COOP is also set we go to an error page. However, COOP
is enforced but CSP is not, creating a discrepency. 
   <p>For COOP restrict-properties, we believe we should compute sandbox flags at
each redirect step, and use the potentially opaque origin to make COOP switch
decisions. Unlike regular COOP, having both sandbox flags and COOP
restrict-properties should not result in an error page. Instead, both sandbox
flags and COOP restrict-properties will apply.</p>
   <h3 class="heading settled" data-level="7.3" id="window-name-leakage"><span class="secno">7.3. </span><span class="content">Window.name leakage</span><a class="self-link" href="#window-name-leakage"></a></h3>
   <p>When we navigate to a COOP: restrict-properties page and then to a COOP:
unsafe-none page, we need to make sure no state remains from the previous
context, to limit XS-Leaks. Window.name can be set by a crossOriginIsolated
page and it could expose information to the next site.</p>
   <p><img alt="auth provider flow" height="352" src="./resources/name.jpg" width="800"></p>
   <p><em>In this example all the documents with origin A.com can set and target the
window.name property. It is in a different context from the B.com’s page, so we
stash the name when navigating. B.com free to set its own name and use it in
its context. When we navigate back to A.com we reuse the stashed name.</em></p>
   <h4 class="heading settled" data-level="7.3.1" id="window-name-leak"><span class="secno">7.3.1. </span><span class="content">Window name leak</span><a class="self-link" href="#window-name-leak"></a></h4>
   <p><code>name</code> is a same-origin property of the Window object. While it cannot ever be
set or read directly by windows in other browsing context groups, it has the
particularity of being sticky, even during cross-browsing context group
navigations.</p>
   <p><img alt="window name leak" height="272" src="./resources/window_name_leak.jpg" width="744"></p>
   <p><em>Because the property is linked to the window and not the document, this can be
a cross-site leak vector. In this example, the original A.com page, a
potentially crossOriginIsolated page was able to read the window’s name.</em></p>
   <p>It is commonly used for named targetting, which is specifying a string as the
"target" of an anchor tag, a <code>window.open()</code> parameter, etc. to navigate that
target, or retrieve a window handle to it. This also has its own problems,
because we do not want a regular page to be able to navigate a
crossOriginIsolated page ever. Named targeting resulting in navigations are
therefore completely prohibited between browsing context groups. Window
retrieval is similarly not permitted because it would be an XS Leak vector, and
many queries could be used to guess a window’s name.</p>
   <p><img alt="named targeting" height="457" src="./resources/named_targeting.jpg" width="800"></p>
   <p><em>After a same-origin navigation of the opener, it tries to retrieve a handle to
the popup previously opened.</em></p>
   <h4 class="heading settled" data-level="7.3.2" id="short-term-mitigation"><span class="secno">7.3.2. </span><span class="content">Short term mitigation</span><a class="self-link" href="#short-term-mitigation"></a></h4>
   <p>A simple solution to this problem is to clear the window’s name during a
navigation to a different browsing context group in the same COOP group.</p>
   <p><img alt="window name clear" height="284" src="./resources/window_name_clear.jpg" width="748"></p>
   <p><em>In that case, the popup name is cleared when navigating to B.com. When it
navigates back to A.com, the name is cleared again.</em></p>
   <p>This interacts with named targetting, as the name is cleared, targetting cannot
resolve between the main page and the popup after it is navigated. The popup
has to manually update its name to something known by the main page.</p>
   <h4 class="heading settled" data-level="7.3.3" id="long-term-mitigation"><span class="secno">7.3.3. </span><span class="content">Long term mitigation</span><a class="self-link" href="#long-term-mitigation"></a></h4>
   <p>We would prefer a solution that does not interact with named targetting, and
makes it easier and more robust for web developers to use named targeting with
multiple browsing context groups. An option would be to move from a single name
model to a multiple name model. In that case, each browsing context would have
a name per browsing context group that wants to refer to it.</p>
   <p><img alt="name per bcg" height="326" src="./resources/name_per_bcg.jpg" width="747"></p>
   <p><em>Instead of clearing window.name, we link it to the browsing context group that
set it. Named targeting resolves if a page from A.com’s browsing context group
targets the popup using 'myname'. B.com’s browsing context group on the other
hand still sees the name as empty. After it sets a name of its own, it can be
used in B.com’s browsing context without overriding A.com’s set name.</em></p>
   <p>With this solution, we preserve legitimate use cases. We still need to block
named targetting which result in a navigation in a window in another browsing
context group. Note that this mechanism could also be used for browsing context
groups swaps to another COOP group, and to help restore names on back
navigation for example.</p>
  </main>
<script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#bcg-coop-agent-cluster-key">bcg-coop-agent-cluster-key</a><span>, in § 6.3</span>
   <li><a href="#coop-agent-cluster-key">coop-agent-cluster-key</a><span>, in § 6.4</span>
   <li><a href="#coop-enforcement-value">coop-enforcement-value</a><span>, in § 6.1.3</span>
   <li><a href="#coop-enforcement-value-key">coop-enforcement-value-key</a><span>, in § 6.1.3</span>
   <li><a href="#coop-enforcement-value-switch">coop-enforcement-value-switch</a><span>, in § 6.1.3</span>
   <li><a href="#coop-origin">coop-origin</a><span>, in § 6.1.1</span>
   <li><a href="#coop-restrict-properties">coop-restrict-properties</a><span>, in § 6.1.1</span>
   <li><a href="#coop-restrict-properties-plus-coep">coop-restrict-properties-plus-coep</a><span>, in § 6.1.1</span>
   <li><a href="#unrestricted-cross-origin-properties">unrestricted-cross-origin-properties</a><span>, in § 6.2.2</span>
   <li><a href="#unrestricted-cross-origin-property-name">unrestricted-cross-origin-property-name</a><span>, in § 6.2.2</span>
   <li><a href="#virtual-coop-agent-cluster-key">virtual-coop-agent-cluster-key</a><span>, in § 6.3</span>
   <li><a href="#windowproxy-same-coop-key">windowproxy-same-coop-key</a><span>, in § 6.2.2</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="b825946e">domexception</span>
     <li><span class="dfn-paneled" id="f219531c">securityerror</span>
    </ul>
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="a973e0fe">document</span>
    </ul>
   <li>
    <a data-link-type="biblio">[ECMASCRIPT]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="353564d6">agent clusters</span>
    </ul>
   <li>
    <a data-link-type="biblio">[FETCH]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="ee7bba09">response</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="3fa2961f">agent cluster key</span>
     <li><span class="dfn-paneled" id="6d88ab2e">browsing context</span>
     <li><span class="dfn-paneled" id="b18a7aa2">browsing context group switches due to cross-origin opener policy</span>
     <li><span class="dfn-paneled" id="ac3582c3">browsing context set</span>
     <li><span class="dfn-paneled" id="64e8248c">browsing-context-group</span>
     <li><span class="dfn-paneled" id="dbdc69ce">check if an access between two browsing contexts should be reported</span>
     <li><span class="dfn-paneled" id="38308d85">check if coop values require a browsing context group switch</span>
     <li><span class="dfn-paneled" id="0e526336">check if enforcing report-only coop would require a browsing context group switch</span>
     <li><span class="dfn-paneled" id="b0f14108">checking if coop values require a browsing context group switch</span>
     <li><span class="dfn-paneled" id="6b151977">checking if enforcing report-only coop would require a browsing context group switch</span>
     <li><span class="dfn-paneled" id="d8813cef">coep</span>
     <li><span class="dfn-paneled" id="bee39f64">compatible with cross-origin isolation</span>
     <li><span class="dfn-paneled" id="e3892898">coop</span>
     <li><span class="dfn-paneled" id="27d3070e">coop-enforcement-origin</span>
     <li><span class="dfn-paneled" id="006fd69c">coop-same-origin</span>
     <li><span class="dfn-paneled" id="921ae6ae">creating a new top-level browsing context and document</span>
     <li><span class="dfn-paneled" id="2a9c82c5">cross-origin isolation mode</span>
     <li><span class="dfn-paneled" id="924e5259">cross-origin opener policy</span>
     <li><span class="dfn-paneled" id="e0009358">cross-origin opener policy enforcement result</span>
     <li><span class="dfn-paneled" id="047398fc">cross-origin-embedder-policy</span>
     <li><span class="dfn-paneled" id="20d23287">cross-origin-opener-policy</span>
     <li><span class="dfn-paneled" id="9e0e363c">cross-origin-opener-policy-value</span>
     <li><span class="dfn-paneled" id="36a8eb64">crossoriginget</span>
     <li><span class="dfn-paneled" id="8b7207b5">crossorigingetownpropertyhelper</span>
     <li><span class="dfn-paneled" id="c396a551">crossoriginproperties</span>
     <li><span class="dfn-paneled" id="ee0c219c">crossoriginset</span>
     <li><span class="dfn-paneled" id="c39f86ff">current context is navigation source</span>
     <li><span class="dfn-paneled" id="ce3d2bbb">current global object</span>
     <li><span class="dfn-paneled" id="12b8dfc0">current settings object</span>
     <li><span class="dfn-paneled" id="b998573a">embedder-policy-value-2</span>
     <li><span class="dfn-paneled" id="6967630c">enforce a response's cross-origin opener policy</span>
     <li><span class="dfn-paneled" id="77a2dc1b">environment</span>
     <li><span class="dfn-paneled" id="f58ae318">integration with the javascript agent cluster formalism</span>
     <li><span class="dfn-paneled" id="fcb86cbe">location-getownproperty</span>
     <li><span class="dfn-paneled" id="9d6eb4de">matching-coop</span>
     <li><span class="dfn-paneled" id="823c1af0">needs a browsing context group switch</span>
     <li><span class="dfn-paneled" id="c56b026c">obtain a browsing context to use for a navigation response</span>
     <li><span class="dfn-paneled" id="e7c981a5">obtain a cross-origin opener policy</span>
     <li><span class="dfn-paneled" id="50a80b1e">obtaining a cross-origin embedder policy</span>
     <li><span class="dfn-paneled" id="3124aef9">origin</span>
     <li><span class="dfn-paneled" id="febdb5d0">popup sandboxing flag set</span>
     <li><span class="dfn-paneled" id="50ff827d">queue a violation report for browsing context group switch when navigating away from a coop response</span>
     <li><span class="dfn-paneled" id="2bdd075e">queue a violation report for browsing context group switch when navigating to a coop response</span>
     <li><span class="dfn-paneled" id="9c4c1e66">relevant settings object</span>
     <li><span class="dfn-paneled" id="2a1d90e1">report-only value</span>
     <li><span class="dfn-paneled" id="21fb816b">same-origin-allow-popups</span>
     <li><span class="dfn-paneled" id="8af97c1e">same-origin-plus-coep</span>
     <li><span class="dfn-paneled" id="fb9bb722">site</span>
     <li><span class="dfn-paneled" id="c2fcb960">top-level browsing context</span>
     <li><span class="dfn-paneled" id="1d2aa117">tuple origin</span>
     <li><span class="dfn-paneled" id="8c60e063">unsafe-none</span>
     <li><span class="dfn-paneled" id="bc2c9476">virtual browsing context group id</span>
     <li><span class="dfn-paneled" id="eb4c1ba2">windowproxy</span>
     <li><span class="dfn-paneled" id="d0ac0059">windowproxy-get</span>
     <li><span class="dfn-paneled" id="de20523e">windowproxy-getownproperty</span>
     <li><span class="dfn-paneled" id="65c708ed">windowproxy-set</span>
     <li><span class="dfn-paneled" id="f105c78a">would need a browsing context group switch due to report-only</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="e2eac3f1">list-size</span>
     <li><span class="dfn-paneled" id="0e8de730">tuple</span>
    </ul>
   <li>
    <a data-link-type="biblio">[URL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="dcffbccd">url</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/"><cite>DOM Standard</cite></a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-ecmascript">[ECMASCRIPT]
   <dd><a href="https://tc39.es/ecma262/multipage/"><cite>ECMAScript Language Specification</cite></a>. URL: <a href="https://tc39.es/ecma262/multipage/">https://tc39.es/ecma262/multipage/</a>
   <dt id="biblio-fetch">[FETCH]
   <dd>Anne van Kesteren. <a href="https://fetch.spec.whatwg.org/"><cite>Fetch Standard</cite></a>. Living Standard. URL: <a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-url">[URL]
   <dd>Anne van Kesteren. <a href="https://url.spec.whatwg.org/"><cite>URL Standard</cite></a>. Living Standard. URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-spectre">[Spectre]
   <dd>Paul Kocher; et al. <a href="https://spectreattack.com/spectre.pdf"><cite>Spectre Attacks: Exploiting Speculative Execution</cite></a>. URL: <a href="https://spectreattack.com/spectre.pdf">https://spectreattack.com/spectre.pdf</a>
   <dt id="biblio-whycoopcoep">[WhyCoopCoep]
   <dd>Eiji Kitamura; Demenic Denicola. <a href="https://web.dev/why-coop-coep/"><cite>Why you need "cross-origin isolated" for powerful features</cite></a>. URL: <a href="https://web.dev/why-coop-coep/">https://web.dev/why-coop-coep/</a>
  </dl>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
    const dfnsJson = window.dfnsJson || {};

    function genDfnPanel({dfnID, url, dfnText, refSections, external}) {
        return mk.aside({
            class: "dfn-panel",
            id: `infopanel-for-${dfnID}`,
            "data-for": dfnID,
            "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
            },
            mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
                `Info about the '${dfnText}' ${external?"external":""} reference.`),
            mk.a({href:url}, url),
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({
                                    href: `#${ref.id}`
                                    },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        );
    }

    function genAllDfnPanels() {
        for(const panelData of Object.values(window.dfnpanelData)) {
            const dfnID = panelData.dfnID;
            const dfn = document.getElementById(dfnID);
            if(!dfn) {
                console.log(`Can't find dfn#${dfnID}.`, panelData);
            } else {
                const panel = genDfnPanel(panelData);
                append(document.body, panel);
                insertDfnPopupAction(dfn, panel)
            }
        }
    }

    document.addEventListener("DOMContentLoaded", ()=>{
        genAllDfnPanels();

        // Add popup behavior to all dfns to show the corresponding dfn-panel.
        var dfns = queryAll('.dfn-paneled');
        for(let dfn of dfns) { ; }

        document.body.addEventListener("click", (e) => {
            // If not handled already, just hide all dfn panels.
            hideAllDfnPanels();
        });
    })


    function hideAllDfnPanels() {
        // Turn off any currently "on" or "activated" panels.
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>hideDfnPanel(el));
    }

    function showDfnPanel(dfnPanel, dfn) {
        hideAllDfnPanels(); // Only display one at this time.
        dfn.setAttribute("aria-expanded", "true");
        dfnPanel.classList.add("on");
        dfnPanel.style.left = "5px";
        dfnPanel.style.top = "0px";
        const panelRect = dfnPanel.getBoundingClientRect();
        const panelWidth = panelRect.right - panelRect.left;
        if (panelRect.right > document.body.scrollWidth) {
            // Panel's overflowing the screen.
            // Just drop it below the dfn and flip it rightward instead.
            // This still wont' fix things if the screen is *really* wide,
            // but fixing that's a lot harder without 'anchor()'.
            dfnPanel.style.top = "1.5em";
            dfnPanel.style.left = "auto";
            dfnPanel.style.right = "0px";
        }
    }

    function pinDfnPanel(dfnPanel) {
        // Switch it to "activated" state, which pins it.
        dfnPanel.classList.add("activated");
        dfnPanel.style.left = null;
        dfnPanel.style.top = null;
    }

    function hideDfnPanel(dfnPanel, dfn) {
        if(!dfn) {
            dfn = document.getElementById(dfnPanel.getAttribute("data-for"));
        }
        dfn.setAttribute("aria-expanded", "false")
        dfnPanel.classList.remove("on");
        dfnPanel.classList.remove("activated");
    }

    function toggleDfnPanel(dfnPanel, dfn) {
        if(dfnPanel.classList.contains("on")) {
            hideDfnPanel(dfnPanel, dfn);
        } else {
            showDfnPanel(dfnPanel, dfn);
        }
    }

    function insertDfnPopupAction(dfn, dfnPanel) {
        // Find dfn panel
        const panelWrapper = document.createElement('span');
        panelWrapper.appendChild(dfnPanel);
        panelWrapper.style.position = "relative";
        panelWrapper.style.height = "0px";
        dfn.insertAdjacentElement("afterend", panelWrapper);
        dfn.setAttribute('role', 'button');
        dfn.setAttribute('aria-expanded', 'false')
        dfn.tabIndex = 0;
        dfn.classList.add('has-dfn-panel');
        dfn.addEventListener('click', (event) => {
            showDfnPanel(dfnPanel, dfn);
            event.stopPropagation();
        });
        dfn.addEventListener('keypress', (event) => {
            const kc = event.keyCode;
            // 32->Space, 13->Enter
            if(kc == 32 || kc == 13) {
                toggleDfnPanel(dfnPanel, dfn);
                event.stopPropagation();
                event.preventDefault();
            }
        });

        dfnPanel.addEventListener('click', (event) => {
            if (event.target.nodeName == 'A') {
                pinDfnPanel(dfnPanel);
            }
            event.stopPropagation();
        });

        dfnPanel.addEventListener('keydown', (event) => {
            if(event.keyCode == 27) { // Escape key
                hideDfnPanel(dfnPanel, dfn);
                event.stopPropagation();
                event.preventDefault();
            }
        })
    }
}
</script>
<script>/* Boilerplate: script-dfn-panel */
"use strict";
{
    const dfnsJson = window.dfnsJson || {};

    function genDfnPanel({dfnID, url, dfnText, refSections, external}) {
        return mk.aside({
            class: "dfn-panel",
            id: `infopanel-for-${dfnID}`,
            "data-for": dfnID,
            "aria-labelled-by":`infopaneltitle-for-${dfnID}`,
            },
            mk.span({id:`infopaneltitle-for-${dfnID}`, style:"display:none"},
                `Info about the '${dfnText}' ${external?"external":""} reference.`),
            mk.a({href:url}, url),
            mk.b({}, "Referenced in:"),
            mk.ul({},
                ...refSections.map(section=>
                    mk.li({},
                        ...section.refs.map((ref, refI)=>
                            [
                                mk.a({
                                    href: `#${ref.id}`
                                    },
                                    (refI == 0) ? section.title : `(${refI + 1})`
                                ),
                                " ",
                            ]
                        ),
                    ),
                ),
            ),
        );
    }

    function genAllDfnPanels() {
        for(const panelData of Object.values(window.dfnpanelData)) {
            const dfnID = panelData.dfnID;
            const dfn = document.getElementById(dfnID);
            if(!dfn) {
                console.log(`Can't find dfn#${dfnID}.`, panelData);
            } else {
                const panel = genDfnPanel(panelData);
                append(document.body, panel);
                insertDfnPopupAction(dfn, panel)
            }
        }
    }

    document.addEventListener("DOMContentLoaded", ()=>{
        genAllDfnPanels();

        // Add popup behavior to all dfns to show the corresponding dfn-panel.
        var dfns = queryAll('.dfn-paneled');
        for(let dfn of dfns) { ; }

        document.body.addEventListener("click", (e) => {
            // If not handled already, just hide all dfn panels.
            hideAllDfnPanels();
        });
    })


    function hideAllDfnPanels() {
        // Turn off any currently "on" or "activated" panels.
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(el=>hideDfnPanel(el));
    }

    function showDfnPanel(dfnPanel, dfn) {
        hideAllDfnPanels(); // Only display one at this time.
        dfn.setAttribute("aria-expanded", "true");
        dfnPanel.classList.add("on");
        dfnPanel.style.left = "5px";
        dfnPanel.style.top = "0px";
        const panelRect = dfnPanel.getBoundingClientRect();
        const panelWidth = panelRect.right - panelRect.left;
        if (panelRect.right > document.body.scrollWidth) {
            // Panel's overflowing the screen.
            // Just drop it below the dfn and flip it rightward instead.
            // This still wont' fix things if the screen is *really* wide,
            // but fixing that's a lot harder without 'anchor()'.
            dfnPanel.style.top = "1.5em";
            dfnPanel.style.left = "auto";
            dfnPanel.style.right = "0px";
        }
    }

    function pinDfnPanel(dfnPanel) {
        // Switch it to "activated" state, which pins it.
        dfnPanel.classList.add("activated");
        dfnPanel.style.left = null;
        dfnPanel.style.top = null;
    }

    function hideDfnPanel(dfnPanel, dfn) {
        if(!dfn) {
            dfn = document.getElementById(dfnPanel.getAttribute("data-for"));
        }
        dfn.setAttribute("aria-expanded", "false")
        dfnPanel.classList.remove("on");
        dfnPanel.classList.remove("activated");
    }

    function toggleDfnPanel(dfnPanel, dfn) {
        if(dfnPanel.classList.contains("on")) {
            hideDfnPanel(dfnPanel, dfn);
        } else {
            showDfnPanel(dfnPanel, dfn);
        }
    }

    function insertDfnPopupAction(dfn, dfnPanel) {
        // Find dfn panel
        const panelWrapper = document.createElement('span');
        panelWrapper.appendChild(dfnPanel);
        panelWrapper.style.position = "relative";
        panelWrapper.style.height = "0px";
        dfn.insertAdjacentElement("afterend", panelWrapper);
        dfn.setAttribute('role', 'button');
        dfn.setAttribute('aria-expanded', 'false')
        dfn.tabIndex = 0;
        dfn.classList.add('has-dfn-panel');
        dfn.addEventListener('click', (event) => {
            showDfnPanel(dfnPanel, dfn);
            event.stopPropagation();
        });
        dfn.addEventListener('keypress', (event) => {
            const kc = event.keyCode;
            // 32->Space, 13->Enter
            if(kc == 32 || kc == 13) {
                toggleDfnPanel(dfnPanel, dfn);
                event.stopPropagation();
                event.preventDefault();
            }
        });

        dfnPanel.addEventListener('click', (event) => {
            if (event.target.nodeName == 'A') {
                pinDfnPanel(dfnPanel);
            }
            event.stopPropagation();
        });

        dfnPanel.addEventListener('keydown', (event) => {
            if(event.keyCode == 27) { // Escape key
                hideDfnPanel(dfnPanel, dfn);
                event.stopPropagation();
                event.preventDefault();
            }
        })
    }
}
</script>
<script>/* Boilerplate: script-dfn-panel-json */
window.dfnpanelData = {};
window.dfnpanelData['b825946e'] = {"dfnID": "b825946e", "url": "https://webidl.spec.whatwg.org/#LegacyUnenumerableNamedPropertiesdfn-DOMException", "dfnText": "domexception", "refSections": [{"refs": [{"id": "ref-for-LegacyUnenumerableNamedPropertiesdfn-DOMException"}], "title": "6.2.2. The WindowProxy exotic object"}], "external": true};
window.dfnpanelData['f219531c'] = {"dfnID": "f219531c", "url": "https://webidl.spec.whatwg.org/#LegacyUnenumerableNamedPropertiessecurityerror", "dfnText": "securityerror", "refSections": [{"refs": [{"id": "ref-for-LegacyUnenumerableNamedPropertiessecurityerror"}], "title": "6.2.2. The WindowProxy exotic object"}], "external": true};
window.dfnpanelData['a973e0fe'] = {"dfnID": "a973e0fe", "url": "https://dom.spec.whatwg.org/#concept-document", "dfnText": "document", "refSections": [{"refs": [{"id": "ref-for-concept-document"}, {"id": "ref-for-concept-document\u2460"}], "title": "6.1.1. Cross-origin opener policy values"}], "external": true};
window.dfnpanelData['353564d6'] = {"dfnID": "353564d6", "url": "https://tc39.es/ecma262/multipage/executable-code-and-execution-contexts.html#sec-agent-clusters", "dfnText": "agent clusters", "refSections": [{"refs": [{"id": "ref-for-sec-agent-clusters"}, {"id": "ref-for-sec-agent-clusters\u2460"}], "title": "6.1.1. Cross-origin opener policy values"}], "external": true};
window.dfnpanelData['ee7bba09'] = {"dfnID": "ee7bba09", "url": "https://fetch.spec.whatwg.org/#concept-response", "dfnText": "response", "refSections": [{"refs": [{"id": "ref-for-concept-response"}], "title": "6.1.2. Obtaining a cross-origin opener policy"}], "external": true};
window.dfnpanelData['3fa2961f'] = {"dfnID": "3fa2961f", "url": "https://html.spec.whatwg.org/C/#agent-cluster-key", "dfnText": "agent cluster key", "refSections": [{"refs": [{"id": "ref-for-agent-cluster-key"}, {"id": "ref-for-agent-cluster-key\u2460"}], "title": "6.4. Agents and agent clusters"}], "external": true};
window.dfnpanelData['6d88ab2e'] = {"dfnID": "6d88ab2e", "url": "https://html.spec.whatwg.org/multipage/nav-history-apis.html#window-bc", "dfnText": "browsing context", "refSections": [{"refs": [{"id": "ref-for-window-bc"}, {"id": "ref-for-window-bc\u2460"}], "title": "6.2.2. The WindowProxy exotic object"}, {"refs": [{"id": "ref-for-window-bc\u2461"}], "title": "6.3. Browsing contexts"}], "external": true};
window.dfnpanelData['b18a7aa2'] = {"dfnID": "b18a7aa2", "url": "https://html.spec.whatwg.org/C/#browsing-context-group-switches-due-to-cross-origin-opener-policy", "dfnText": "browsing context group switches due to cross-origin opener policy", "refSections": [{"refs": [{"id": "ref-for-browsing-context-group-switches-due-to-cross-origin-opener-policy"}], "title": "6.1.3. Browsing context group switches due to cross-origin opener policy"}], "external": true};
window.dfnpanelData['ac3582c3'] = {"dfnID": "ac3582c3", "url": "https://html.spec.whatwg.org/C/#browsing context set", "dfnText": "browsing context set", "refSections": [{"refs": [{"id": "ref-for-browsing context set"}, {"id": "ref-for-browsing context set\u2460"}], "title": "6.1.3. Browsing context group switches due to cross-origin opener policy"}], "external": true};
window.dfnpanelData['64e8248c'] = {"dfnID": "64e8248c", "url": "https://html.spec.whatwg.org/C/#browsing-context-group", "dfnText": "browsing-context-group", "refSections": [{"refs": [{"id": "ref-for-browsing-context-group"}], "title": "2. A problem"}, {"refs": [{"id": "ref-for-browsing-context-group\u2460"}], "title": "6.1.1. Cross-origin opener policy values"}, {"refs": [{"id": "ref-for-browsing-context-group\u2461"}, {"id": "ref-for-browsing-context-group\u2462"}], "title": "6.1.3. Browsing context group switches due to cross-origin opener policy"}], "external": true};
window.dfnpanelData['dbdc69ce'] = {"dfnID": "dbdc69ce", "url": "https://html.spec.whatwg.org/C/#coop-check-access-report", "dfnText": "check if an access between two browsing contexts should be reported", "refSections": [{"refs": [{"id": "ref-for-coop-check-access-report"}], "title": "6.1.4. Reporting"}], "external": true};
window.dfnpanelData['38308d85'] = {"dfnID": "38308d85", "url": "https://html.spec.whatwg.org/C/#check-browsing-context-group-switch-coop-value", "dfnText": "check if coop values require a browsing context group switch", "refSections": [{"refs": [{"id": "ref-for-check-browsing-context-group-switch-coop-value"}, {"id": "ref-for-check-browsing-context-group-switch-coop-value\u2460"}, {"id": "ref-for-check-browsing-context-group-switch-coop-value\u2461"}, {"id": "ref-for-check-browsing-context-group-switch-coop-value\u2462"}, {"id": "ref-for-check-browsing-context-group-switch-coop-value\u2463"}], "title": "6.1.3. Browsing context group switches due to cross-origin opener policy"}], "external": true};
window.dfnpanelData['0e526336'] = {"dfnID": "0e526336", "url": "https://html.spec.whatwg.org/C/#check-bcg-switch-report-only", "dfnText": "check if enforcing report-only coop would require a browsing context group switch", "refSections": [{"refs": [{"id": "ref-for-check-bcg-switch-report-only"}, {"id": "ref-for-check-bcg-switch-report-only\u2460"}], "title": "6.1.3. Browsing context group switches due to cross-origin opener policy"}], "external": true};
window.dfnpanelData['b0f14108'] = {"dfnID": "b0f14108", "url": "https://html.spec.whatwg.org/C/#check-browsing-context-group-switch-coop-value", "dfnText": "checking if coop values require a browsing context group switch", "refSections": [{"refs": [{"id": "ref-for-check-browsing-context-group-switch-coop-value"}, {"id": "ref-for-check-browsing-context-group-switch-coop-value\u2460"}, {"id": "ref-for-check-browsing-context-group-switch-coop-value\u2461"}, {"id": "ref-for-check-browsing-context-group-switch-coop-value\u2462"}, {"id": "ref-for-check-browsing-context-group-switch-coop-value\u2463"}], "title": "6.1.3. Browsing context group switches due to cross-origin opener policy"}], "external": true};
window.dfnpanelData['6b151977'] = {"dfnID": "6b151977", "url": "https://html.spec.whatwg.org/C/#check-bcg-switch-report-only", "dfnText": "checking if enforcing report-only coop would require a browsing context group switch", "refSections": [{"refs": [{"id": "ref-for-check-bcg-switch-report-only"}, {"id": "ref-for-check-bcg-switch-report-only\u2460"}], "title": "6.1.3. Browsing context group switches due to cross-origin opener policy"}], "external": true};
window.dfnpanelData['d8813cef'] = {"dfnID": "d8813cef", "url": "https://html.spec.whatwg.org/C/#coep", "dfnText": "coep", "refSections": [{"refs": [{"id": "ref-for-coep"}, {"id": "ref-for-coep\u2460"}], "title": "1.1. Recommended readings"}], "external": true};
window.dfnpanelData['bee39f64'] = {"dfnID": "bee39f64", "url": "https://html.spec.whatwg.org/C/#compatible-with-cross-origin-isolation", "dfnText": "compatible with cross-origin isolation", "refSections": [{"refs": [{"id": "ref-for-compatible-with-cross-origin-isolation"}], "title": "6.1.2. Obtaining a cross-origin opener policy"}], "external": true};
window.dfnpanelData['e3892898'] = {"dfnID": "e3892898", "url": "https://html.spec.whatwg.org/C/#cross-origin-opener-policies", "dfnText": "coop", "refSections": [{"refs": [{"id": "ref-for-cross-origin-opener-policies"}, {"id": "ref-for-cross-origin-opener-policies\u2460"}, {"id": "ref-for-cross-origin-opener-policies\u2461"}, {"id": "ref-for-cross-origin-opener-policies\u2462"}], "title": "1.1. Recommended readings"}, {"refs": [{"id": "ref-for-cross-origin-opener-policies\u2463"}, {"id": "ref-for-cross-origin-opener-policies\u2464"}], "title": "2. A problem"}, {"refs": [{"id": "ref-for-cross-origin-opener-policies\u2465"}], "title": "6.1.3. Browsing context group switches due to cross-origin opener policy"}], "external": true};
window.dfnpanelData['27d3070e'] = {"dfnID": "27d3070e", "url": "https://html.spec.whatwg.org/C/#coop-enforcement-origin", "dfnText": "coop-enforcement-origin", "refSections": [{"refs": [{"id": "ref-for-coop-enforcement-origin"}, {"id": "ref-for-coop-enforcement-origin\u2460"}], "title": "6.1.3. Browsing context group switches due to cross-origin opener policy"}], "external": true};
window.dfnpanelData['006fd69c'] = {"dfnID": "006fd69c", "url": "https://html.spec.whatwg.org/C/#coop-same-origin", "dfnText": "coop-same-origin", "refSections": [{"refs": [{"id": "ref-for-coop-same-origin"}], "title": "2. A problem"}, {"refs": [{"id": "ref-for-coop-same-origin\u2460"}, {"id": "ref-for-coop-same-origin\u2461"}, {"id": "ref-for-coop-same-origin\u2462"}, {"id": "ref-for-coop-same-origin\u2463"}, {"id": "ref-for-coop-same-origin\u2464"}], "title": "6.1.3. Browsing context group switches due to cross-origin opener policy"}], "external": true};
window.dfnpanelData['921ae6ae'] = {"dfnID": "921ae6ae", "url": "https://html.spec.whatwg.org/C/#creating-a-new-top-level-browsing-context", "dfnText": "creating a new top-level browsing context and document", "refSections": [{"refs": [{"id": "ref-for-creating-a-new-top-level-browsing-context"}], "title": "6.1.3. Browsing context group switches due to cross-origin opener policy"}], "external": true};
window.dfnpanelData['2a9c82c5'] = {"dfnID": "2a9c82c5", "url": "https://html.spec.whatwg.org/C/#bcg-cross-origin-isolation", "dfnText": "cross-origin isolation mode", "refSections": [{"refs": [{"id": "ref-for-bcg-cross-origin-isolation"}, {"id": "ref-for-bcg-cross-origin-isolation\u2460"}, {"id": "ref-for-bcg-cross-origin-isolation\u2461"}], "title": "6.1.1. Cross-origin opener policy values"}, {"refs": [{"id": "ref-for-bcg-cross-origin-isolation\u2462"}], "title": "6.4. Agents and agent clusters"}], "external": true};
window.dfnpanelData['924e5259'] = {"dfnID": "924e5259", "url": "https://html.spec.whatwg.org/C/#cross-origin-opener-policy", "dfnText": "cross-origin opener policy", "refSections": [{"refs": [{"id": "ref-for-cross-origin-opener-policy"}], "title": "6.1.1. Cross-origin opener policy values"}, {"refs": [{"id": "ref-for-cross-origin-opener-policy\u2460"}, {"id": "ref-for-cross-origin-opener-policy\u2461"}, {"id": "ref-for-cross-origin-opener-policy\u2462"}, {"id": "ref-for-cross-origin-opener-policy\u2463"}], "title": "6.1.3. Browsing context group switches due to cross-origin opener policy"}], "external": true};
window.dfnpanelData['e0009358'] = {"dfnID": "e0009358", "url": "https://html.spec.whatwg.org/C/#coop-enforcement-result", "dfnText": "cross-origin opener policy enforcement result", "refSections": [{"refs": [{"id": "ref-for-coop-enforcement-result"}], "title": "6.1.3. Browsing context group switches due to cross-origin opener policy"}], "external": true};
window.dfnpanelData['047398fc'] = {"dfnID": "047398fc", "url": "https://html.spec.whatwg.org/C/#coep", "dfnText": "cross-origin-embedder-policy", "refSections": [{"refs": [{"id": "ref-for-coep"}, {"id": "ref-for-coep\u2460"}], "title": "1.1. Recommended readings"}], "external": true};
window.dfnpanelData['20d23287'] = {"dfnID": "20d23287", "url": "https://html.spec.whatwg.org/C/#cross-origin-opener-policies", "dfnText": "cross-origin-opener-policy", "refSections": [{"refs": [{"id": "ref-for-cross-origin-opener-policies"}, {"id": "ref-for-cross-origin-opener-policies\u2460"}, {"id": "ref-for-cross-origin-opener-policies\u2461"}, {"id": "ref-for-cross-origin-opener-policies\u2462"}], "title": "1.1. Recommended readings"}, {"refs": [{"id": "ref-for-cross-origin-opener-policies\u2463"}, {"id": "ref-for-cross-origin-opener-policies\u2464"}], "title": "2. A problem"}, {"refs": [{"id": "ref-for-cross-origin-opener-policies\u2465"}], "title": "6.1.3. Browsing context group switches due to cross-origin opener policy"}], "external": true};
window.dfnpanelData['9e0e363c'] = {"dfnID": "9e0e363c", "url": "https://html.spec.whatwg.org/C/#cross-origin-opener-policy-value", "dfnText": "cross-origin-opener-policy-value", "refSections": [{"refs": [{"id": "ref-for-cross-origin-opener-policy-value"}], "title": "6.1.1. Cross-origin opener policy values"}, {"refs": [{"id": "ref-for-cross-origin-opener-policy-value\u2460"}, {"id": "ref-for-cross-origin-opener-policy-value\u2461"}], "title": "6.1.2. Obtaining a cross-origin opener policy"}, {"refs": [{"id": "ref-for-cross-origin-opener-policy-value\u2462"}, {"id": "ref-for-cross-origin-opener-policy-value\u2463"}, {"id": "ref-for-cross-origin-opener-policy-value\u2464"}, {"id": "ref-for-cross-origin-opener-policy-value\u2465"}, {"id": "ref-for-cross-origin-opener-policy-value\u2466"}, {"id": "ref-for-cross-origin-opener-policy-value\u2467"}, {"id": "ref-for-cross-origin-opener-policy-value\u2468"}, {"id": "ref-for-cross-origin-opener-policy-value\u2460\u24ea"}, {"id": "ref-for-cross-origin-opener-policy-value\u2460\u2460"}, {"id": "ref-for-cross-origin-opener-policy-value\u2460\u2461"}], "title": "6.1.3. Browsing context group switches due to cross-origin opener policy"}], "external": true};
window.dfnpanelData['36a8eb64'] = {"dfnID": "36a8eb64", "url": "https://html.spec.whatwg.org/C/#crossoriginget-(-o,-p,-receiver-)", "dfnText": "crossoriginget", "refSections": [{"refs": [{"id": "ref-for-crossoriginget-(-o,-p,-receiver-)"}], "title": "6.2.2. The WindowProxy exotic object"}], "external": true};
window.dfnpanelData['8b7207b5'] = {"dfnID": "8b7207b5", "url": "https://html.spec.whatwg.org/C/#crossorigingetownpropertyhelper-(-o,-p-)", "dfnText": "crossorigingetownpropertyhelper", "refSections": [{"refs": [{"id": "ref-for-crossorigingetownpropertyhelper-(-o,-p-)"}, {"id": "ref-for-crossorigingetownpropertyhelper-(-o,-p-)\u2460"}], "title": "6.2.1. Security infrastructure for Window, WindowProxy, and Location objects"}, {"refs": [{"id": "ref-for-crossorigingetownpropertyhelper-(-o,-p-)\u2461"}, {"id": "ref-for-crossorigingetownpropertyhelper-(-o,-p-)\u2462"}], "title": "6.2.2. The WindowProxy exotic object"}, {"refs": [{"id": "ref-for-crossorigingetownpropertyhelper-(-o,-p-)\u2463"}], "title": "6.2.3. The Location interface"}], "external": true};
window.dfnpanelData['c396a551'] = {"dfnID": "c396a551", "url": "https://html.spec.whatwg.org/C/#crossoriginproperties-(-o-)", "dfnText": "crossoriginproperties", "refSections": [{"refs": [{"id": "ref-for-crossoriginproperties-(-o-)"}], "title": "6.2.1. Security infrastructure for Window, WindowProxy, and Location objects"}], "external": true};
window.dfnpanelData['ee0c219c'] = {"dfnID": "ee0c219c", "url": "https://html.spec.whatwg.org/C/#crossoriginset-(-o,-p,-receiver-)", "dfnText": "crossoriginset", "refSections": [{"refs": [{"id": "ref-for-crossoriginset-(-o,-p,-receiver-)"}], "title": "6.2.2. The WindowProxy exotic object"}], "external": true};
window.dfnpanelData['c39f86ff'] = {"dfnID": "c39f86ff", "url": "https://html.spec.whatwg.org/C/#coop-enforcement-source", "dfnText": "current context is navigation source", "refSections": [{"refs": [{"id": "ref-for-coop-enforcement-source"}, {"id": "ref-for-coop-enforcement-source\u2460"}], "title": "6.1.3. Browsing context group switches due to cross-origin opener policy"}], "external": true};
window.dfnpanelData['ce3d2bbb'] = {"dfnID": "ce3d2bbb", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#current-global-object", "dfnText": "current global object", "refSections": [{"refs": [{"id": "ref-for-current-global-object"}], "title": "6.2.2. The WindowProxy exotic object"}], "external": true};
window.dfnpanelData['12b8dfc0'] = {"dfnID": "12b8dfc0", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#current-settings-object", "dfnText": "current settings object", "refSections": [{"refs": [{"id": "ref-for-current-settings-object"}], "title": "6.2.1. Security infrastructure for Window, WindowProxy, and Location objects"}], "external": true};
window.dfnpanelData['b998573a'] = {"dfnID": "b998573a", "url": "https://html.spec.whatwg.org/C/#embedder-policy-value-2", "dfnText": "embedder-policy-value-2", "refSections": [{"refs": [{"id": "ref-for-embedder-policy-value-2"}], "title": "6.1.2. Obtaining a cross-origin opener policy"}], "external": true};
window.dfnpanelData['6967630c'] = {"dfnID": "6967630c", "url": "https://html.spec.whatwg.org/C/#coop-enforce", "dfnText": "enforce a response's cross-origin opener policy", "refSections": [{"refs": [{"id": "ref-for-coop-enforce"}], "title": "6.1.3. Browsing context group switches due to cross-origin opener policy"}], "external": true};
window.dfnpanelData['77a2dc1b'] = {"dfnID": "77a2dc1b", "url": "https://html.spec.whatwg.org/C/#environment", "dfnText": "environment", "refSections": [{"refs": [{"id": "ref-for-environment"}], "title": "6.1.2. Obtaining a cross-origin opener policy"}], "external": true};
window.dfnpanelData['f58ae318'] = {"dfnID": "f58ae318", "url": "https://html.spec.whatwg.org/C/#integration-with-the-javascript-agent-cluster-formalism", "dfnText": "integration with the javascript agent cluster formalism", "refSections": [{"refs": [{"id": "ref-for-integration-with-the-javascript-agent-cluster-formalism"}], "title": "6.4. Agents and agent clusters"}], "external": true};
window.dfnpanelData['fcb86cbe'] = {"dfnID": "fcb86cbe", "url": "https://html.spec.whatwg.org/C/#location-getownproperty", "dfnText": "location-getownproperty", "refSections": [{"refs": [{"id": "ref-for-location-getownproperty"}], "title": "6.2.3. The Location interface"}], "external": true};
window.dfnpanelData['9d6eb4de'] = {"dfnID": "9d6eb4de", "url": "https://html.spec.whatwg.org/C/#matching-coop", "dfnText": "matching-coop", "refSections": [{"refs": [{"id": "ref-for-matching-coop"}], "title": "6.1.3. Browsing context group switches due to cross-origin opener policy"}], "external": true};
window.dfnpanelData['823c1af0'] = {"dfnID": "823c1af0", "url": "https://html.spec.whatwg.org/C/#coop-enforcement-bcg-switch", "dfnText": "needs a browsing context group switch", "refSections": [{"refs": [{"id": "ref-for-coop-enforcement-bcg-switch"}, {"id": "ref-for-coop-enforcement-bcg-switch\u2460"}, {"id": "ref-for-coop-enforcement-bcg-switch\u2461"}, {"id": "ref-for-coop-enforcement-bcg-switch\u2462"}, {"id": "ref-for-coop-enforcement-bcg-switch\u2463"}], "title": "6.1.3. Browsing context group switches due to cross-origin opener policy"}], "external": true};
window.dfnpanelData['c56b026c'] = {"dfnID": "c56b026c", "url": "https://html.spec.whatwg.org/C/#obtain-browsing-context-navigation", "dfnText": "obtain a browsing context to use for a navigation response", "refSections": [{"refs": [{"id": "ref-for-obtain-browsing-context-navigation"}], "title": "6.1.3. Browsing context group switches due to cross-origin opener policy"}], "external": true};
window.dfnpanelData['e7c981a5'] = {"dfnID": "e7c981a5", "url": "https://html.spec.whatwg.org/C/#obtain-coop", "dfnText": "obtain a cross-origin opener policy", "refSections": [{"refs": [{"id": "ref-for-obtain-coop"}, {"id": "ref-for-obtain-coop\u2460"}], "title": "6.1.2. Obtaining a cross-origin opener policy"}], "external": true};
window.dfnpanelData['50a80b1e'] = {"dfnID": "50a80b1e", "url": "https://html.spec.whatwg.org/C/#obtain-an-embedder-policy", "dfnText": "obtaining a cross-origin embedder policy", "refSections": [{"refs": [{"id": "ref-for-obtain-an-embedder-policy"}], "title": "6.1.2. Obtaining a cross-origin opener policy"}], "external": true};
window.dfnpanelData['3124aef9'] = {"dfnID": "3124aef9", "url": "https://html.spec.whatwg.org/C/#concept-origin", "dfnText": "origin", "refSections": [{"refs": [{"id": "ref-for-concept-origin"}, {"id": "ref-for-concept-origin\u2460"}], "title": "6.1.1. Cross-origin opener policy values"}, {"refs": [{"id": "ref-for-concept-origin\u2461"}], "title": "6.1.2. Obtaining a cross-origin opener policy"}, {"refs": [{"id": "ref-for-concept-origin\u2462"}, {"id": "ref-for-concept-origin\u2463"}, {"id": "ref-for-concept-origin\u2464"}, {"id": "ref-for-concept-origin\u2465"}], "title": "6.1.3. Browsing context group switches due to cross-origin opener policy"}, {"refs": [{"id": "ref-for-concept-origin\u2466"}], "title": "6.4. Agents and agent clusters"}], "external": true};
window.dfnpanelData['febdb5d0'] = {"dfnID": "febdb5d0", "url": "https://html.spec.whatwg.org/C/#popup-sandboxing-flag-set", "dfnText": "popup sandboxing flag set", "refSections": [{"refs": [{"id": "ref-for-popup-sandboxing-flag-set"}, {"id": "ref-for-popup-sandboxing-flag-set\u2460"}], "title": "6.1.3. Browsing context group switches due to cross-origin opener policy"}], "external": true};
window.dfnpanelData['50ff827d'] = {"dfnID": "50ff827d", "url": "https://html.spec.whatwg.org/C/#coop-violation-navigation-from", "dfnText": "queue a violation report for browsing context group switch when navigating away from a coop response", "refSections": [{"refs": [{"id": "ref-for-coop-violation-navigation-from"}, {"id": "ref-for-coop-violation-navigation-from\u2460"}], "title": "6.1.3. Browsing context group switches due to cross-origin opener policy"}], "external": true};
window.dfnpanelData['2bdd075e'] = {"dfnID": "2bdd075e", "url": "https://html.spec.whatwg.org/C/#coop-violation-navigation-to", "dfnText": "queue a violation report for browsing context group switch when navigating to a coop response", "refSections": [{"refs": [{"id": "ref-for-coop-violation-navigation-to"}, {"id": "ref-for-coop-violation-navigation-to\u2460"}], "title": "6.1.3. Browsing context group switches due to cross-origin opener policy"}], "external": true};
window.dfnpanelData['9c4c1e66'] = {"dfnID": "9c4c1e66", "url": "https://html.spec.whatwg.org/multipage/webappapis.html#relevant-settings-object", "dfnText": "relevant settings object", "refSections": [{"refs": [{"id": "ref-for-relevant-settings-object"}], "title": "6.2.1. Security infrastructure for Window, WindowProxy, and Location objects"}], "external": true};
window.dfnpanelData['2a1d90e1'] = {"dfnID": "2a1d90e1", "url": "https://html.spec.whatwg.org/C/#coop-struct-report-only-value", "dfnText": "report-only value", "refSections": [{"refs": [{"id": "ref-for-coop-struct-report-only-value"}, {"id": "ref-for-coop-struct-report-only-value\u2460"}, {"id": "ref-for-coop-struct-report-only-value\u2461"}, {"id": "ref-for-coop-struct-report-only-value\u2462"}], "title": "6.1.3. Browsing context group switches due to cross-origin opener policy"}, {"refs": [{"id": "ref-for-coop-struct-report-only-value\u2463"}], "title": "6.3. Browsing contexts"}], "external": true};
window.dfnpanelData['21fb816b'] = {"dfnID": "21fb816b", "url": "https://html.spec.whatwg.org/C/#coop-same-origin-allow-popups", "dfnText": "same-origin-allow-popups", "refSections": [{"refs": [{"id": "ref-for-coop-same-origin-allow-popups"}], "title": "6.1.3. Browsing context group switches due to cross-origin opener policy"}], "external": true};
window.dfnpanelData['8af97c1e'] = {"dfnID": "8af97c1e", "url": "https://html.spec.whatwg.org/C/#coop-same-origin-plus-coep", "dfnText": "same-origin-plus-coep", "refSections": [{"refs": [{"id": "ref-for-coop-same-origin-plus-coep"}, {"id": "ref-for-coop-same-origin-plus-coep\u2460"}, {"id": "ref-for-coop-same-origin-plus-coep\u2461"}, {"id": "ref-for-coop-same-origin-plus-coep\u2462"}, {"id": "ref-for-coop-same-origin-plus-coep\u2463"}, {"id": "ref-for-coop-same-origin-plus-coep\u2464"}], "title": "6.1.3. Browsing context group switches due to cross-origin opener policy"}], "external": true};
window.dfnpanelData['fb9bb722'] = {"dfnID": "fb9bb722", "url": "https://html.spec.whatwg.org/multipage/browsers.html#site", "dfnText": "site", "refSections": [{"refs": [{"id": "ref-for-site"}], "title": "6.4. Agents and agent clusters"}], "external": true};
window.dfnpanelData['c2fcb960'] = {"dfnID": "c2fcb960", "url": "https://html.spec.whatwg.org/C/#top-level-browsing-context", "dfnText": "top-level browsing context", "refSections": [{"refs": [{"id": "ref-for-top-level-browsing-context"}], "title": "6.1.1. Cross-origin opener policy values"}, {"refs": [{"id": "ref-for-top-level-browsing-context\u2460"}], "title": "6.1.3. Browsing context group switches due to cross-origin opener policy"}, {"refs": [{"id": "ref-for-top-level-browsing-context\u2461"}, {"id": "ref-for-top-level-browsing-context\u2462"}, {"id": "ref-for-top-level-browsing-context\u2463"}, {"id": "ref-for-top-level-browsing-context\u2464"}], "title": "6.1.4. Reporting"}, {"refs": [{"id": "ref-for-top-level-browsing-context\u2465"}, {"id": "ref-for-top-level-browsing-context\u2466"}], "title": "6.2.2. The WindowProxy exotic object"}], "external": true};
window.dfnpanelData['1d2aa117'] = {"dfnID": "1d2aa117", "url": "https://html.spec.whatwg.org/multipage/browsers.html#concept-origin-tuple", "dfnText": "tuple origin", "refSections": [{"refs": [{"id": "ref-for-concept-origin-tuple"}, {"id": "ref-for-concept-origin-tuple\u2460"}], "title": "6.4. Agents and agent clusters"}], "external": true};
window.dfnpanelData['8c60e063'] = {"dfnID": "8c60e063", "url": "https://html.spec.whatwg.org/C/#coop-unsafe-none", "dfnText": "unsafe-none", "refSections": [{"refs": [{"id": "ref-for-coop-unsafe-none"}], "title": "6.1.3. Browsing context group switches due to cross-origin opener policy"}], "external": true};
window.dfnpanelData['bc2c9476'] = {"dfnID": "bc2c9476", "url": "https://html.spec.whatwg.org/C/#virtual-browsing-context-group-id", "dfnText": "virtual browsing context group id", "refSections": [{"refs": [{"id": "ref-for-virtual-browsing-context-group-id"}], "title": "6.1.3. Browsing context group switches due to cross-origin opener policy"}, {"refs": [{"id": "ref-for-virtual-browsing-context-group-id\u2460"}, {"id": "ref-for-virtual-browsing-context-group-id\u2461"}], "title": "6.1.4. Reporting"}], "external": true};
window.dfnpanelData['eb4c1ba2'] = {"dfnID": "eb4c1ba2", "url": "https://html.spec.whatwg.org/C/#the-window-proxy-exotic-object", "dfnText": "windowproxy", "refSections": [{"refs": [{"id": "ref-for-the-window-proxy-exotic-object"}], "title": "6.1.1. Cross-origin opener policy values"}, {"refs": [{"id": "ref-for-the-window-proxy-exotic-object\u2460"}], "title": "6.2.2. The WindowProxy exotic object"}], "external": true};
window.dfnpanelData['d0ac0059'] = {"dfnID": "d0ac0059", "url": "https://html.spec.whatwg.org/C/#windowproxy-get", "dfnText": "windowproxy-get", "refSections": [{"refs": [{"id": "ref-for-windowproxy-get"}], "title": "6.2.2. The WindowProxy exotic object"}], "external": true};
window.dfnpanelData['de20523e'] = {"dfnID": "de20523e", "url": "https://html.spec.whatwg.org/C/#windowproxy-getownproperty", "dfnText": "windowproxy-getownproperty", "refSections": [{"refs": [{"id": "ref-for-windowproxy-getownproperty"}, {"id": "ref-for-windowproxy-getownproperty\u2460"}], "title": "6.2.2. The WindowProxy exotic object"}], "external": true};
window.dfnpanelData['65c708ed'] = {"dfnID": "65c708ed", "url": "https://html.spec.whatwg.org/C/#windowproxy-set", "dfnText": "windowproxy-set", "refSections": [{"refs": [{"id": "ref-for-windowproxy-set"}], "title": "6.2.2. The WindowProxy exotic object"}], "external": true};
window.dfnpanelData['f105c78a'] = {"dfnID": "f105c78a", "url": "https://html.spec.whatwg.org/C/#coop-enforcement-bcg-switch-report-only", "dfnText": "would need a browsing context group switch due to report-only", "refSections": [{"refs": [{"id": "ref-for-coop-enforcement-bcg-switch-report-only"}, {"id": "ref-for-coop-enforcement-bcg-switch-report-only\u2460"}, {"id": "ref-for-coop-enforcement-bcg-switch-report-only\u2461"}, {"id": "ref-for-coop-enforcement-bcg-switch-report-only\u2462"}, {"id": "ref-for-coop-enforcement-bcg-switch-report-only\u2463"}], "title": "6.1.3. Browsing context group switches due to cross-origin opener policy"}], "external": true};
window.dfnpanelData['e2eac3f1'] = {"dfnID": "e2eac3f1", "url": "https://infra.spec.whatwg.org/#list-size", "dfnText": "list-size", "refSections": [{"refs": [{"id": "ref-for-list-size"}, {"id": "ref-for-list-size\u2460"}], "title": "6.1.3. Browsing context group switches due to cross-origin opener policy"}], "external": true};
window.dfnpanelData['0e8de730'] = {"dfnID": "0e8de730", "url": "https://infra.spec.whatwg.org/#tuple", "dfnText": "tuple", "refSections": [{"refs": [{"id": "ref-for-tuple"}, {"id": "ref-for-tuple\u2460"}], "title": "6.4. Agents and agent clusters"}], "external": true};
window.dfnpanelData['dcffbccd'] = {"dfnID": "dcffbccd", "url": "https://url.spec.whatwg.org/#concept-url", "dfnText": "url", "refSections": [{"refs": [{"id": "ref-for-concept-url"}, {"id": "ref-for-concept-url\u2460"}, {"id": "ref-for-concept-url\u2461"}, {"id": "ref-for-concept-url\u2462"}], "title": "6.1.3. Browsing context group switches due to cross-origin opener policy"}], "external": true};
window.dfnpanelData['coop-restrict-properties'] = {"dfnID": "coop-restrict-properties", "url": "#coop-restrict-properties", "dfnText": "restrict-properties", "refSections": [{"refs": [{"id": "ref-for-coop-restrict-properties"}], "title": "6.1.1. Cross-origin opener policy values"}, {"refs": [{"id": "ref-for-coop-restrict-properties\u2460"}, {"id": "ref-for-coop-restrict-properties\u2461"}], "title": "6.1.2. Obtaining a cross-origin opener policy"}, {"refs": [{"id": "ref-for-coop-restrict-properties\u2462"}, {"id": "ref-for-coop-restrict-properties\u2463"}], "title": "6.1.3. Browsing context group switches due to cross-origin opener policy"}], "external": false};
window.dfnpanelData['coop-restrict-properties-plus-coep'] = {"dfnID": "coop-restrict-properties-plus-coep", "url": "#coop-restrict-properties-plus-coep", "dfnText": "restrict-properties-plus-coep", "refSections": [{"refs": [{"id": "ref-for-coop-restrict-properties-plus-coep"}], "title": "6.1.2. Obtaining a cross-origin opener policy"}, {"refs": [{"id": "ref-for-coop-restrict-properties-plus-coep\u2460"}, {"id": "ref-for-coop-restrict-properties-plus-coep\u2461"}, {"id": "ref-for-coop-restrict-properties-plus-coep\u2462"}], "title": "6.1.3. Browsing context group switches due to cross-origin opener policy"}], "external": false};
window.dfnpanelData['coop-origin'] = {"dfnID": "coop-origin", "url": "#coop-origin", "dfnText": "COOP origin", "refSections": [{"refs": [{"id": "ref-for-coop-origin"}], "title": "6.1.2. Obtaining a cross-origin opener policy"}], "external": false};
window.dfnpanelData['coop-enforcement-value'] = {"dfnID": "coop-enforcement-value", "url": "#coop-enforcement-value", "dfnText": "cross-origin opener policy enforcement\nvalue", "refSections": [{"refs": [{"id": "ref-for-coop-enforcement-value"}, {"id": "ref-for-coop-enforcement-value\u2460"}, {"id": "ref-for-coop-enforcement-value\u2461"}, {"id": "ref-for-coop-enforcement-value\u2462"}, {"id": "ref-for-coop-enforcement-value\u2463"}], "title": "6.1.3. Browsing context group switches due to cross-origin opener policy"}], "external": false};
window.dfnpanelData['coop-enforcement-value-switch'] = {"dfnID": "coop-enforcement-value-switch", "url": "#coop-enforcement-value-switch", "dfnText": "browsingContextGroupSwitchNeeded", "refSections": [{"refs": [{"id": "ref-for-coop-enforcement-value-switch"}, {"id": "ref-for-coop-enforcement-value-switch\u2460"}, {"id": "ref-for-coop-enforcement-value-switch\u2461"}, {"id": "ref-for-coop-enforcement-value-switch\u2462"}, {"id": "ref-for-coop-enforcement-value-switch\u2463"}, {"id": "ref-for-coop-enforcement-value-switch\u2464"}, {"id": "ref-for-coop-enforcement-value-switch\u2465"}, {"id": "ref-for-coop-enforcement-value-switch\u2466"}, {"id": "ref-for-coop-enforcement-value-switch\u2467"}, {"id": "ref-for-coop-enforcement-value-switch\u2468"}, {"id": "ref-for-coop-enforcement-value-switch\u2460\u24ea"}, {"id": "ref-for-coop-enforcement-value-switch\u2460\u2460"}], "title": "6.1.3. Browsing context group switches due to cross-origin opener policy"}], "external": false};
window.dfnpanelData['coop-enforcement-value-key'] = {"dfnID": "coop-enforcement-value-key", "url": "#coop-enforcement-value-key", "dfnText": "agentClusterKey", "refSections": [{"refs": [{"id": "ref-for-coop-enforcement-value-key"}, {"id": "ref-for-coop-enforcement-value-key\u2460"}, {"id": "ref-for-coop-enforcement-value-key\u2461"}, {"id": "ref-for-coop-enforcement-value-key\u2462"}, {"id": "ref-for-coop-enforcement-value-key\u2463"}, {"id": "ref-for-coop-enforcement-value-key\u2464"}, {"id": "ref-for-coop-enforcement-value-key\u2465"}], "title": "6.1.3. Browsing context group switches due to cross-origin opener policy"}], "external": false};
window.dfnpanelData['unrestricted-cross-origin-properties'] = {"dfnID": "unrestricted-cross-origin-properties", "url": "#unrestricted-cross-origin-properties", "dfnText": "UnrestrictedCrossOriginProperties(W)", "refSections": [{"refs": [{"id": "ref-for-unrestricted-cross-origin-properties"}], "title": "6.2.1. Security infrastructure for Window, WindowProxy, and Location objects"}], "external": false};
window.dfnpanelData['unrestricted-cross-origin-property-name'] = {"dfnID": "unrestricted-cross-origin-property-name", "url": "#unrestricted-cross-origin-property-name", "dfnText": "unrestricted cross-origin\naccessible window property name", "refSections": [{"refs": [{"id": "ref-for-unrestricted-cross-origin-property-name"}], "title": "6.1.4. Reporting"}], "external": false};
window.dfnpanelData['windowproxy-same-coop-key'] = {"dfnID": "windowproxy-same-coop-key", "url": "#windowproxy-same-coop-key", "dfnText": "WindowProxyHasSameCOOPKey(W)", "refSections": [{"refs": [{"id": "ref-for-windowproxy-same-coop-key"}, {"id": "ref-for-windowproxy-same-coop-key\u2460"}, {"id": "ref-for-windowproxy-same-coop-key\u2461"}], "title": "6.2.2. The WindowProxy exotic object"}], "external": false};
window.dfnpanelData['bcg-coop-agent-cluster-key'] = {"dfnID": "bcg-coop-agent-cluster-key", "url": "#bcg-coop-agent-cluster-key", "dfnText": "COOP agent cluster key", "refSections": [{"refs": [{"id": "ref-for-bcg-coop-agent-cluster-key"}], "title": "6.1.3. Browsing context group switches due to cross-origin opener policy"}, {"refs": [{"id": "ref-for-bcg-coop-agent-cluster-key\u2460"}, {"id": "ref-for-bcg-coop-agent-cluster-key\u2461"}], "title": "6.2.2. The WindowProxy exotic object"}], "external": false};
window.dfnpanelData['virtual-coop-agent-cluster-key'] = {"dfnID": "virtual-coop-agent-cluster-key", "url": "#virtual-coop-agent-cluster-key", "dfnText": "virtual COOP agent cluster\nkey", "refSections": [{"refs": [{"id": "ref-for-virtual-coop-agent-cluster-key"}], "title": "6.1.3. Browsing context group switches due to cross-origin opener policy"}, {"refs": [{"id": "ref-for-virtual-coop-agent-cluster-key\u2460"}, {"id": "ref-for-virtual-coop-agent-cluster-key\u2461"}], "title": "6.1.4. Reporting"}], "external": false};
window.dfnpanelData['coop-agent-cluster-key'] = {"dfnID": "coop-agent-cluster-key", "url": "#coop-agent-cluster-key", "dfnText": "COOP agent cluster key", "refSections": [{"refs": [{"id": "ref-for-coop-agent-cluster-key"}], "title": "6.1.3. Browsing context group switches due to cross-origin opener policy"}, {"refs": [{"id": "ref-for-coop-agent-cluster-key\u2460"}, {"id": "ref-for-coop-agent-cluster-key\u2461"}], "title": "6.3. Browsing contexts"}, {"refs": [{"id": "ref-for-coop-agent-cluster-key\u2462"}], "title": "6.4. Agents and agent clusters"}], "external": false};
</script>
<script>/* Boilerplate: script-dom-helper */
function query(sel) { return document.querySelector(sel); }

function queryAll(sel) { return [...document.querySelectorAll(sel)]; }

function iter(obj) {
	if(!obj) return [];
	var it = obj[Symbol.iterator];
	if(it) return it;
	return Object.entries(obj);
}

function mk(tagname, attrs, ...children) {
	const el = document.createElement(tagname);
	for(const [k,v] of iter(attrs)) {
		if(k.slice(0,3) == "_on") {
			const eventName = k.slice(3);
			el.addEventListener(eventName, v);
		} else if(k[0] == "_") {
			// property, not attribute
			el[k.slice(1)] = v;
		} else {
			if(v === false || v == null) {
        continue;
      } else if(v === true) {
        el.setAttribute(k, "");
        continue;
      } else {
  			el.setAttribute(k, v);
      }
		}
	}
	append(el, children);
	return el;
}

/* Create shortcuts for every known HTML element */
[
  "a",
  "abbr",
  "acronym",
  "address",
  "applet",
  "area",
  "article",
  "aside",
  "audio",
  "b",
  "base",
  "basefont",
  "bdo",
  "big",
  "blockquote",
  "body",
  "br",
  "button",
  "canvas",
  "caption",
  "center",
  "cite",
  "code",
  "col",
  "colgroup",
  "datalist",
  "dd",
  "del",
  "details",
  "dfn",
  "dialog",
  "div",
  "dl",
  "dt",
  "em",
  "embed",
  "fieldset",
  "figcaption",
  "figure",
  "font",
  "footer",
  "form",
  "frame",
  "frameset",
  "head",
  "header",
  "h1",
  "h2",
  "h3",
  "h4",
  "h5",
  "h6",
  "hr",
  "html",
  "i",
  "iframe",
  "img",
  "input",
  "ins",
  "kbd",
  "label",
  "legend",
  "li",
  "link",
  "main",
  "map",
  "mark",
  "meta",
  "meter",
  "nav",
  "nobr",
  "noscript",
  "object",
  "ol",
  "optgroup",
  "option",
  "output",
  "p",
  "param",
  "pre",
  "progress",
  "q",
  "s",
  "samp",
  "script",
  "section",
  "select",
  "small",
  "source",
  "span",
  "strike",
  "strong",
  "style",
  "sub",
  "summary",
  "sup",
  "table",
  "tbody",
  "td",
  "template",
  "textarea",
  "tfoot",
  "th",
  "thead",
  "time",
  "title",
  "tr",
  "u",
  "ul",
  "var",
  "video",
  "wbr",
  "xmp",
].forEach(tagname=>{
	mk[tagname] = (...args) => mk(tagname, ...args);
});

function* nodesFromChildList(children) {
	for(const child of children.flat(Infinity)) {
		if(child instanceof Node) {
			yield child;
		} else {
			yield new Text(child);
		}
	}
}
function append(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		if(el instanceof Node) el.appendChild(child);
		else el.push(child);
	}
	return el;
}

function insertAfter(el, ...children) {
	for(const child of nodesFromChildList(children)) {
		el.parentNode.insertBefore(child, el.nextSibling);
	}
	return el;
}

function clearContents(el) {
	el.innerHTML = "";
	return el;
}

function parseHTML(markup) {
	if(markup.toLowerCase().trim().indexOf('<!doctype') === 0) {
		const doc = document.implementation.createHTMLDocument("");
		doc.documentElement.innerHTML = markup;
		return doc;
	} else {
		const el = mk.template({});
		el.innerHTML = markup;
		return el.content;
	}
}
</script>